<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Source: lib/genxlsx.js</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/jaguar.css">
    
    
    <script>
    var config = {"monospaceLinks":false,"cleverLinks":false,"default":{"outputSourceFiles":true}};
    </script>
    

    
</head>
<body>
<div id="wrap" class="clearfix">
    
<div class="navigation">
    <h3 class="applicationName"><a href="index.html"></a></h3>

    <div class="search">
        <input id="search" type="text" class="form-control input-sm" placeholder="Search Documentations">
    </div>
    <ul class="list">
    
        <li class="item" data-name="gruntfile">
            <span class="title">
                <a href="gruntfile.html">gruntfile</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="gruntfile.default"><a href="gruntfile.html#.default">default</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="officegen#plugins">
            <span class="title">
                <a href="officegen_plugins.html">officegen#plugins</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="officegen#plugins.getDocTypeByName"><a href="officegen_plugins.html#.getDocTypeByName">getDocTypeByName</a></li>
            
                <li data-name="officegen#plugins.getPrototypeByName"><a href="officegen_plugins.html#.getPrototypeByName">getPrototypeByName</a></li>
            
                <li data-name="officegen#plugins.getVerboseMode"><a href="officegen_plugins.html#.getVerboseMode">getVerboseMode</a></li>
            
                <li data-name="officegen#plugins.registerDocType"><a href="officegen_plugins.html#.registerDocType">registerDocType</a></li>
            
                <li data-name="officegen#plugins.registerParserType"><a href="officegen_plugins.html#.registerParserType">registerParserType</a></li>
            
                <li data-name="officegen#plugins.registerPrototype"><a href="officegen_plugins.html#.registerPrototype">registerPrototype</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="officegen#private">
            <span class="title">
                <a href="officegen_private.html">officegen#private</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="officegen#private#plugs">
            <span class="title">
                <a href="officegen_private_plugs.html">officegen#private#plugs</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="officegen#private#plugs.type"><a href="officegen_private_plugs.html#.type">type</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="officegen#private#plugs.intAddAnyResourceToParse"><a href="officegen_private_plugs.html#.intAddAnyResourceToParse">intAddAnyResourceToParse</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="makedocpluginapi">
            <span class="title">
                <a href="makedocpluginapi.html">makedocpluginapi</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="makedocpluginapi#emitEvent"><a href="makedocpluginapi.html#emitEvent">emitEvent</a></li>
            
                <li data-name="makedocpluginapi#getDataStorage"><a href="makedocpluginapi.html#getDataStorage">getDataStorage</a></li>
            
                <li data-name="makedocpluginapi#getFeaturesStorage"><a href="makedocpluginapi.html#getFeaturesStorage">getFeaturesStorage</a></li>
            
                <li data-name="makedocpluginapi#getVerboseMode"><a href="makedocpluginapi.html#getVerboseMode">getVerboseMode</a></li>
            
                <li data-name="makedocpluginapi#logIfVerbose"><a href="makedocpluginapi.html#logIfVerbose">logIfVerbose</a></li>
            
                <li data-name="makedocpluginapi#registerCallback"><a href="makedocpluginapi.html#registerCallback">registerCallback</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="makeDocx">
            <span class="title">
                <a href="makeDocx.html">makeDocx</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="makeDocx~cbMakeDocxApp"><a href="makeDocx.html#~cbMakeDocxApp">cbMakeDocxApp</a></li>
            
                <li data-name="makeDocx~cbMakeDocxDocument"><a href="makeDocx.html#~cbMakeDocxDocument">cbMakeDocxDocument</a></li>
            
                <li data-name="makeDocx~cbMakeDocxFontsTable"><a href="makeDocx.html#~cbMakeDocxFontsTable">cbMakeDocxFontsTable</a></li>
            
                <li data-name="makeDocx~cbMakeDocxSettings"><a href="makeDocx.html#~cbMakeDocxSettings">cbMakeDocxSettings</a></li>
            
                <li data-name="makeDocx~cbMakeDocxStyles"><a href="makeDocx.html#~cbMakeDocxStyles">cbMakeDocxStyles</a></li>
            
                <li data-name="makeDocx~cbMakeDocxWeb"><a href="makeDocx.html#~cbMakeDocxWeb">cbMakeDocxWeb</a></li>
            
                <li data-name="makeDocx~cbPrepareDocxToGenerate"><a href="makeDocx.html#~cbPrepareDocxToGenerate">cbPrepareDocxToGenerate</a></li>
            
                <li data-name="makeDocx~setDefaultDocValues"><a href="makeDocx.html#~setDefaultDocValues">setDefaultDocValues</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="makelayoutplugin">
            <span class="title">
                <a href="makelayoutplugin.html">makelayoutplugin</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="makelayoutplugin#beforeGen"><a href="makelayoutplugin.html#beforeGen">beforeGen</a></li>
            
                <li data-name="makelayoutplugin#extendPptxApi"><a href="makelayoutplugin.html#extendPptxApi">extendPptxApi</a></li>
            
                <li data-name="makelayoutplugin#extendPptxSlideApi"><a href="makelayoutplugin.html#extendPptxSlideApi">extendPptxSlideApi</a></li>
            
                <li data-name="makelayoutplugin#setData"><a href="makelayoutplugin.html#setData">setData</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="makemsdoc">
            <span class="title">
                <a href="makemsdoc.html">makemsdoc</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="makemsdoc~cbMakeCore"><a href="makemsdoc.html#~cbMakeCore">cbMakeCore</a></li>
            
                <li data-name="makemsdoc~cbMakeMainFilesList"><a href="makemsdoc.html#~cbMakeMainFilesList">cbMakeMainFilesList</a></li>
            
                <li data-name="makemsdoc~cbMakeTheme"><a href="makemsdoc.html#~cbMakeTheme">cbMakeTheme</a></li>
            
                <li data-name="makemsdoc~cbOfficeClearAfterGenerate"><a href="makemsdoc.html#~cbOfficeClearAfterGenerate">cbOfficeClearAfterGenerate</a></li>
            
                <li data-name="makemsdoc~cbOfficeClearDocData"><a href="makemsdoc.html#~cbOfficeClearDocData">cbOfficeClearDocData</a></li>
            
                <li data-name="makemsdoc~clearSmartArrayFromType"><a href="makemsdoc.html#~clearSmartArrayFromType">clearSmartArrayFromType</a></li>
            
                <li data-name="makemsdoc~compactArray"><a href="makemsdoc.html#~compactArray">compactArray</a></li>
            
                <li data-name="makemsdoc~getCurDateTimeForOffice"><a href="makemsdoc.html#~getCurDateTimeForOffice">getCurDateTimeForOffice</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="makeoodoc">
            <span class="title">
                <a href="makeoodoc.html">makeoodoc</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="makeoodoc~makeOpenOfficeMimeType"><a href="makeoodoc.html#~makeOpenOfficeMimeType">makeOpenOfficeMimeType</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="makePptx">
            <span class="title">
                <a href="makePptx.html">makePptx</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="makePptx~cbGenerateEffects"><a href="makePptx.html#~cbGenerateEffects">cbGenerateEffects</a></li>
            
                <li data-name="makePptx~cbMakeCharts"><a href="makePptx.html#~cbMakeCharts">cbMakeCharts</a></li>
            
                <li data-name="makePptx~cbMakePptxApp"><a href="makePptx.html#~cbMakePptxApp">cbMakePptxApp</a></li>
            
                <li data-name="makePptx~cbMakePptxLayout"><a href="makePptx.html#~cbMakePptxLayout">cbMakePptxLayout</a></li>
            
                <li data-name="makePptx~cbMakePptxPresentation"><a href="makePptx.html#~cbMakePptxPresentation">cbMakePptxPresentation</a></li>
            
                <li data-name="makePptx~cbMakePptxPresProps"><a href="makePptx.html#~cbMakePptxPresProps">cbMakePptxPresProps</a></li>
            
                <li data-name="makePptx~cbMakePptxSlide"><a href="makePptx.html#~cbMakePptxSlide">cbMakePptxSlide</a></li>
            
                <li data-name="makePptx~cbMakePptxSlideMasters"><a href="makePptx.html#~cbMakePptxSlideMasters">cbMakePptxSlideMasters</a></li>
            
                <li data-name="makePptx~cbMakePptxStyles"><a href="makePptx.html#~cbMakePptxStyles">cbMakePptxStyles</a></li>
            
                <li data-name="makePptx~cbMakePptxViewProps"><a href="makePptx.html#~cbMakePptxViewProps">cbMakePptxViewProps</a></li>
            
                <li data-name="makePptx~cbPreparePptxToGenerate"><a href="makePptx.html#~cbPreparePptxToGenerate">cbPreparePptxToGenerate</a></li>
            
                <li data-name="makePptx~cMakePptxColorSelection"><a href="makePptx.html#~cMakePptxColorSelection">cMakePptxColorSelection</a></li>
            
                <li data-name="makePptx~cMakePptxOutTextCommand"><a href="makePptx.html#~cMakePptxOutTextCommand">cMakePptxOutTextCommand</a></li>
            
                <li data-name="makePptx~cMakePptxOutTextData"><a href="makePptx.html#~cMakePptxOutTextData">cMakePptxOutTextData</a></li>
            
                <li data-name="makePptx~createBodyProperties"><a href="makePptx.html#~createBodyProperties">createBodyProperties</a></li>
            
                <li data-name="makePptx~CreateFieldText"><a href="makePptx.html#~CreateFieldText">CreateFieldText</a></li>
            
                <li data-name="makePptx~getShapeInfo"><a href="makePptx.html#~getShapeInfo">getShapeInfo</a></li>
            
                <li data-name="makePptx~parseSmartNumber"><a href="makePptx.html#~parseSmartNumber">parseSmartNumber</a></li>
            
                <li data-name="makePptx~setDefaultDocValues"><a href="makePptx.html#~setDefaultDocValues">setDefaultDocValues</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="makespknotesplugin">
            <span class="title">
                <a href="makespknotesplugin.html">makespknotesplugin</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="makespknotesplugin#beforeGen"><a href="makespknotesplugin.html#beforeGen">beforeGen</a></li>
            
                <li data-name="makespknotesplugin#cbMakePptxNotesMasters"><a href="makespknotesplugin.html#cbMakePptxNotesMasters">cbMakePptxNotesMasters</a></li>
            
                <li data-name="makespknotesplugin#cbMakePptxSpkNote"><a href="makespknotesplugin.html#cbMakePptxSpkNote">cbMakePptxSpkNote</a></li>
            
                <li data-name="makespknotesplugin#cbMakeTheme2"><a href="makespknotesplugin.html#cbMakeTheme2">cbMakeTheme2</a></li>
            
                <li data-name="makespknotesplugin#extendPptxSlideApi"><a href="makespknotesplugin.html#extendPptxSlideApi">extendPptxSlideApi</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="makewidescreenplugin">
            <span class="title">
                <a href="makewidescreenplugin.html">makewidescreenplugin</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="makewidescreenplugin#extendPptxApi"><a href="makewidescreenplugin.html#extendPptxApi">extendPptxApi</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="makeXlsx">
            <span class="title">
                <a href="makeXlsx.html">makeXlsx</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="makeXlsx~cbCellToNumber"><a href="makeXlsx.html#~cbCellToNumber">cbCellToNumber</a></li>
            
                <li data-name="makeXlsx~cbMakeXlsApp"><a href="makeXlsx.html#~cbMakeXlsApp">cbMakeXlsApp</a></li>
            
                <li data-name="makeXlsx~cbMakeXlsSharedStrings"><a href="makeXlsx.html#~cbMakeXlsSharedStrings">cbMakeXlsSharedStrings</a></li>
            
                <li data-name="makeXlsx~cbMakeXlsSheet"><a href="makeXlsx.html#~cbMakeXlsSheet">cbMakeXlsSheet</a></li>
            
                <li data-name="makeXlsx~cbMakeXlsStyles"><a href="makeXlsx.html#~cbMakeXlsStyles">cbMakeXlsStyles</a></li>
            
                <li data-name="makeXlsx~cbMakeXlsWorkbook"><a href="makeXlsx.html#~cbMakeXlsWorkbook">cbMakeXlsWorkbook</a></li>
            
                <li data-name="makeXlsx~cbNumberToCell"><a href="makeXlsx.html#~cbNumberToCell">cbNumberToCell</a></li>
            
                <li data-name="makeXlsx~cbPrepareXlsxToGenerate"><a href="makeXlsx.html#~cbPrepareXlsxToGenerate">cbPrepareXlsxToGenerate</a></li>
            
                <li data-name="makeXlsx~setDefaultDocValues"><a href="makeXlsx.html#~setDefaultDocValues">setDefaultDocValues</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="officegen">
            <span class="title">
                <a href="officegen.html">officegen</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="officegen#addResourceToParse"><a href="officegen.html#addResourceToParse">addResourceToParse</a></li>
            
                <li data-name="officegen#generate"><a href="officegen.html#generate">generate</a></li>
            
                <li data-name="officegen#startNewDoc"><a href="officegen.html#startNewDoc">startNewDoc</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
    </ul>
</div>
    <div class="main">
        <h1 class="page-title" data-filename="lib_genxlsx.js.html">Source: lib/genxlsx.js</h1>
        


    
    <section>
        <article>
            <pre id="source-code" class="prettyprint source "><code>//
// officegen: All the code to generate XLSX files.
//
// Please refer to README.md for this module's documentations.
//
// NOTE:
// - Before changing this code please refer to the hacking the code section on README.md.
//
// Copyright (c) 2013 Ziv Barber;
//
// Permission is hereby granted, free of charge, to any person obtaining
// a copy of this software and associated documentation files (the
// 'Software'), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to
// permit persons to whom the Software is furnished to do so, subject to
// the following conditions:
//
// The above copyright notice and this permission notice shall be
// included in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,
// EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
// IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
// CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
// TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
// SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
//

/**
 * Basicgen plugin to create xlsx files (Microsoft Excel).
 */

var baseobj = require("./basicgen.js");
var msdoc = require("./msofficegen.js");

var docplugman = require('./docplug');

// Officegen xlsx plugins:
// BMK_XLSX_PLUG:

if ( !String.prototype.encodeHTML ) {
	String.prototype.encodeHTML = function () {
		return this.replace(/&amp;/g, '&amp;amp;')
			.replace(/&lt;/g, '&amp;lt;')
			.replace(/>/g, '&amp;gt;')
			.replace(/"/g, '&amp;quot;');
	};
}

/**
 * Extend officegen object with XLSX support.
 *
 * This method extending the given officegen object to create XLSX document.
 *
 * @param {object} genobj The object to extend.
 * @param {string} new_type The type of object to create.
 * @param {object} options The object's options.
 * @param {object} gen_private Access to the internals of this object.
 * @param {object} type_info Additional information about this type.
 * @constructor
 * @name makeXlsx
 */
function makeXlsx ( genobj, new_type, options, gen_private, type_info ) {
	/**
	 * Prepare the default data.
	 * @param {object} docpluginman Access to the document plugins manager.
	 */
	function setDefaultDocValues ( docpluginman ) {
		var pptxData = docpluginman.getDataStorage ();

		// Please put any setting that API can override here:
	}

	/**
	 * Create the shared string resource.
	 *
	 * This resource holding all the text strings of any Excel document.
	 *
	 * @param {object} data Ignored by this callback function.
	 * @return Text string.
	 */
	function cbMakeXlsSharedStrings ( data ) {
		var outString = gen_private.plugs.type.msoffice.cbMakeMsOfficeBasicXml ( data ) + '&lt;sst xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" count="' + genobj.generate_data.total_strings + '" uniqueCount="' + genobj.generate_data.shared_strings.length + '">';

		for ( var i = 0, total_size = genobj.generate_data.shared_strings.length; i &lt; total_size; i++ ) {
			outString += '&lt;si>&lt;t>' + genobj.generate_data.shared_strings[i].encodeHTML () + '&lt;/t>&lt;/si>';
		} // Endif.

		return outString + '&lt;/sst>';
	}

	/**
	 * Prepare everything to generate XLSX files.
	 *
	 * This method working on all the Excel cells to find out information needed by the generator engine.
	 */
	function cbPrepareXlsxToGenerate () {
		genobj.generate_data = {};
		genobj.generate_data.shared_strings = [];
		genobj.lookup_strings = {};
		genobj.generate_data.total_strings = 0;
		genobj.generate_data.cell_strings = [];

		// Tell all the features (plugins) that we are about to generate a new document zip:
		gen_private.features.type.xlsx.emitEvent ( 'beforeGen', genobj );

		// Allow some plugins to do more stuff after all the plugins added their data:
		gen_private.features.type.xlsx.emitEvent ( 'beforeGenFinal', genobj );

		// Create the share strings data:
		for ( var i = 0, total_size = gen_private.pages.length; i &lt; total_size; i++ ) {
			if ( gen_private.pages[i] ) {
				for ( var rowId = 0, total_size_y = gen_private.pages[i].sheet.data.length; rowId &lt; total_size_y; rowId++ ) {
					if ( gen_private.pages[i].sheet.data[rowId] ) {
						for ( var columnId = 0, total_size_x = gen_private.pages[i].sheet.data[rowId].length; columnId &lt; total_size_x; columnId++ ) {
							if ( typeof gen_private.pages[i].sheet.data[rowId][columnId] != 'undefined' ) {
								switch ( typeof gen_private.pages[i].sheet.data[rowId][columnId] ) {
									case 'string':
										genobj.generate_data.total_strings++;

										if ( !genobj.generate_data.cell_strings[i] ) {
											genobj.generate_data.cell_strings[i] = [];
										} // Endif.

										if ( !genobj.generate_data.cell_strings[i][rowId] ) {
											genobj.generate_data.cell_strings[i][rowId] = [];
										} // Endif.

										var shared_str = gen_private.pages[i].sheet.data[rowId][columnId];

										if (shared_str in genobj.lookup_strings) {
											genobj.generate_data.cell_strings[i][rowId][columnId] = genobj.lookup_strings[ shared_str ];

										} else {
											var shared_str_position = genobj.generate_data.shared_strings.length;
											genobj.generate_data.cell_strings[i][rowId][columnId] = shared_str_position;
											genobj.lookup_strings[ shared_str ] = shared_str_position;
											genobj.generate_data.shared_strings[shared_str_position] = shared_str;
										} // Endif.
										break;
								} // End of switch.
							} // Endif.
						} // End of for loop.
					} // Endif.
				} // End of for loop.
			} // Endif.
		} // End of for loop.

		if ( genobj.generate_data.total_strings ) {
			gen_private.plugs.intAddAnyResourceToParse ( 'xl\\sharedStrings.xml', 'buffer', null, cbMakeXlsSharedStrings, false );
			gen_private.type.msoffice.files_list.push (
				{
					name: '/xl/sharedStrings.xml',
					type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml',
					clear: 'generate'
				}
			);

			gen_private.type.msoffice.rels_app.push (
				{
					type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings',
					target: 'sharedStrings.xml',
					clear: 'generate'
				}
			);
		} // Endif.
	}

	/**
	 * ???.
	 *
	 * @param {object} data Ignored by this callback function.
	 * @return Text string.
	 */
	function cbMakeXlsStyles ( data ) {
		return gen_private.plugs.type.msoffice.cbMakeMsOfficeBasicXml ( data ) + '&lt;styleSheet xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main">&lt;fonts count="1">&lt;font>&lt;sz val="11"/>&lt;color theme="1"/>&lt;name val="Calibri"/>&lt;family val="2"/>&lt;scheme val="minor"/>&lt;/font>&lt;/fonts>&lt;fills count="2">&lt;fill>&lt;patternFill patternType="none"/>&lt;/fill>&lt;fill>&lt;patternFill patternType="gray125"/>&lt;/fill>&lt;/fills>&lt;borders count="1">&lt;border>&lt;left/>&lt;right/>&lt;top/>&lt;bottom/>&lt;diagonal/>&lt;/border>&lt;/borders>&lt;cellStyleXfs count="1">&lt;xf numFmtId="0" fontId="0" fillId="0" borderId="0"/>&lt;/cellStyleXfs>&lt;cellXfs count="2">&lt;xf numFmtId="0" fontId="0" fillId="0" borderId="0" xfId="0"/>&lt;xf applyAlignment="1" borderId="0" fillId="0" fontId="0" numFmtId="0" xfId="0">&lt;alignment wrapText="1"/>&lt;/xf>&lt;/cellXfs>&lt;cellStyles count="1">&lt;cellStyle name="Normal" xfId="0" builtinId="0"/>&lt;/cellStyles>&lt;dxfs count="0"/>&lt;tableStyles count="0" defaultTableStyle="TableStyleMedium9" defaultPivotStyle="PivotStyleLight16"/>&lt;/styleSheet>';
	}

	/**
	 * ???.
	 *
	 * @param {object} data Ignored by this callback function.
	 * @return Text string.
	 */
	function cbMakeXlsApp ( data ) {
		var pagesCount = gen_private.pages.length;
		var userName = genobj.options.author || genobj.options.creator || 'officegen';
		var outString = gen_private.plugs.type.msoffice.cbMakeMsOfficeBasicXml ( data ) + '&lt;Properties xmlns="http://schemas.openxmlformats.org/officeDocument/2006/extended-properties" xmlns:vt="http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes">&lt;Application>Microsoft Excel&lt;/Application>&lt;DocSecurity>0&lt;/DocSecurity>&lt;ScaleCrop>false&lt;/ScaleCrop>&lt;HeadingPairs>&lt;vt:vector size="2" baseType="variant">&lt;vt:variant>&lt;vt:lpstr>Worksheets&lt;/vt:lpstr>&lt;/vt:variant>&lt;vt:variant>&lt;vt:i4>' + pagesCount + '&lt;/vt:i4>&lt;/vt:variant>&lt;/vt:vector>&lt;/HeadingPairs>&lt;TitlesOfParts>&lt;vt:vector size="' + pagesCount + '" baseType="lpstr">';

		for ( var i = 0, total_size = gen_private.pages.length; i &lt; total_size; i++ ) {
			outString += '&lt;vt:lpstr>Sheet' + (i + 1) + '&lt;/vt:lpstr>';
		} // End of for loop.

		outString += '&lt;/vt:vector>&lt;/TitlesOfParts>&lt;Company>' + userName + '&lt;/Company>&lt;LinksUpToDate>false&lt;/LinksUpToDate>&lt;SharedDoc>false&lt;/SharedDoc>&lt;HyperlinksChanged>false&lt;/HyperlinksChanged>&lt;AppVersion>12.0000&lt;/AppVersion>&lt;/Properties>';
		return outString;
	}

	/**
	 * ???.
	 *
	 * @param {object} data Ignored by this callback function.
	 * @return Text string.
	 */
	function cbMakeXlsWorkbook ( data ) {
		var outString = gen_private.plugs.type.msoffice.cbMakeMsOfficeBasicXml ( data ) + '&lt;workbook xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships">&lt;fileVersion appName="xl" lastEdited="4" lowestEdited="4" rupBuild="4507"/>&lt;workbookPr defaultThemeVersion="124226"/>&lt;bookViews>&lt;workbookView xWindow="120" yWindow="75" windowWidth="19095" windowHeight="7485"/>&lt;/bookViews>&lt;sheets>';

		for ( var i = 0, total_size = gen_private.pages.length; i &lt; total_size; i++ ) {
			var sheetName = gen_private.pages[i].sheet.name || 'Sheet' + (i + 1);
                        var rId = gen_private.pages[i].relId;
			outString += '&lt;sheet name="' + sheetName + '" sheetId="' + (i + 1) + '" r:id="rId' + rId + '"/>';
		} // End of for loop.

		outString += '&lt;/sheets>&lt;calcPr calcId="125725"/>&lt;/workbook>';
		return outString;
	}

	/**
	 * Translate from the Excel displayed row name into index number.
	 *
	 * @param {string} cell_string Either the cell displayed position or the row displayed position.
	 * @param {boolean} ret_also_column ???.
	 * @return The cell's row Id.
	 */
	function cbCellToNumber ( cell_string, ret_also_column ) {
		var cellNumber = 0;
		var cellIndex = 0;
		var cellMax = cell_string.length;
		var rowId = 0;

		// Converted from C++ (from DuckWriteC++):
		while ( cellIndex &lt; cellMax )
		{
			var curChar = cell_string.charCodeAt ( cellIndex );
			if ( (curChar >= 0x30) &amp;&amp; (curChar &lt;= 0x39) )
			{
				rowId = parseInt ( cell_string.slice ( cellIndex ), 10 );
				rowId = (rowId > 0) ? (rowId - 1) : 0;
				break;

			} else if ( (curChar >= 0x41) &amp;&amp; (curChar &lt;= 0x5A) )
			{
				if ( cellIndex > 0 )
				{
					cellNumber++;
					cellNumber *= (0x5B-0x41);
				} // Endif.

				cellNumber += (curChar - 0x41);

			} else if ( (curChar >= 0x61) &amp;&amp; (curChar &lt;= 0x7A) )
			{
				if ( cellIndex > 0 )
				{
					cellNumber++;
					cellNumber *= (0x5B-0x41);
				} // Endif.

				cellNumber += (curChar - 0x61);
			} // Endif.

			cellIndex++;
		} // End of while loop.

		if ( ret_also_column ) {
			return { row: rowId, column: cellNumber };
		} // Endif.

		return cellNumber;
	}

	/**
	 * ???.
	 *
	 * @param {object} cell_number ???.
	 * @return ???.
	 */
	function cbNumberToCell ( cell_number ) {
		var outCell = '';
		var curCell = cell_number;

		while ( curCell >= 0 )
		{
			outCell = String.fromCharCode ( (curCell % (0x5B-0x41)) + 0x41 ) + outCell;
			if ( curCell >= (0x5B-0x41) )
				curCell = Math.floor ( curCell / (0x5B-0x41) ) - 1;
			else
				break;
		} // End of while loop.

		return outCell;
	}

	/**
	 * ???.
	 *
	 * @param {object} data The main sheet object.
	 * @return Text string.
	 */
	function cbMakeXlsSheet ( data ) {
		var outString = gen_private.plugs.type.msoffice.cbMakeMsOfficeBasicXml ( data ) + '&lt;worksheet xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships">';
		var maxX = 0;
		var maxY = 0;
		var curColMax;
		var rowId;
		var columnId;

		// Find the maximum cells area:
		maxY = data.sheet.data.length ? (data.sheet.data.length - 1) : 0;
		for ( rowId = 0, total_size_y = data.sheet.data.length; rowId &lt; total_size_y; rowId++ ) {
			if ( data.sheet.data[rowId] ) {
				curColMax = data.sheet.data[rowId].length ? (data.sheet.data[rowId].length - 1) : 0;
				maxX = maxX &lt; curColMax ? curColMax : maxX;
			} // Endif.
		} // End of for loop.

		outString += '&lt;dimension ref="A1:' + cbNumberToCell ( maxX ) + '' + (maxY + 1) + '"/>&lt;sheetViews>';
		outString += '&lt;sheetView tabSelected="1" workbookViewId="0"/>';
		// outString += '&lt;selection activeCell="A1" sqref="A1"/>';
		outString += '&lt;/sheetViews>&lt;sheetFormatPr defaultRowHeight="15"/>';

		if ( data.sheet.width ) {
			outString += '&lt;cols>';
			for ( var i = 0; i &lt; data.sheet.width.length; i++ ) {
				outString += "&lt;col min=\"" + (i+1) + "\" max=\"" + (i+1) + "\" width=\"" + data.sheet.width[i] + "\" customWidth=\"1\"/>";
			}
			outString += '&lt;/cols>';
		}

		outString += '&lt;sheetData>';

		for ( rowId = 0, total_size_y = data.sheet.data.length; rowId &lt; total_size_y; rowId++ ) {
			if ( data.sheet.data[rowId] ) {
				// Patch by arnesten &lt;notifications@github.com>: Automatically support line breaks if used in cell + calculates row height:
                var rowLines = 1;
                data.sheet.data[rowId].forEach(function (cellData) {
                    if (typeof cellData === 'string') {
                        var candidate = cellData.split('\n').length;
                        rowLines = Math.max(rowLines, candidate);
                    }
                });
				outString += '&lt;row r="' + (rowId + 1) + '" spans="1:' + (data.sheet.data[rowId].length) + '" ht="' + ( rowLines * 15 ) + '">';
				// End of patch.

				for ( columnId = 0, total_size_x = data.sheet.data[rowId].length; columnId &lt; total_size_x; columnId++ ) {
                    var cellData = data.sheet.data[rowId][columnId];
                    if ( typeof  cellData != 'undefined' ) {
						var isString = '';
						var cellOutData = '0';

						switch ( typeof cellData ) {
							case 'number':
								cellOutData = cellData;
								break;

							case 'string':
								cellOutData = genobj.generate_data.cell_strings[data.id][rowId][columnId];
                                if (cellData.indexOf('\n') >= 0) {
                                    isString = ' s="1" t="s"';
                                }
                                else {
                                    isString = ' t="s"';
                                }
								break;
						} // End of switch.

						outString += '&lt;c r="' + cbNumberToCell ( columnId ) + '' + (rowId + 1) + '"' + isString + '>&lt;v>' + cellOutData + '&lt;/v>&lt;/c>';
					} // Endif.
				} // End of for loop.

				outString += '&lt;/row>';
			} // Endif.
		} // End of for loop.

		outString += '&lt;/sheetData>&lt;pageMargins left="0.7" right="0.7" top="0.75" bottom="0.75" header="0.3" footer="0.3"/>&lt;/worksheet>';
		return outString;
	}

	// Prepare genobj for MS-Office:
	msdoc.makemsdoc ( genobj, new_type, options, gen_private, type_info );
	gen_private.plugs.type.msoffice.makeOfficeGenerator ( 'xl', 'workbook', {} );

	gen_private.features.page_name = 'sheets'; // This document type must have pages.

	// On each generate we'll prepare the shared strings list:
	genobj.on ( 'beforeGen', cbPrepareXlsxToGenerate );

	// Create the plugins manager:
	var plugsmanObj = new docplugman ( genobj, gen_private, 'xlsx', setDefaultDocValues );

	// We'll register now any officegen internal plugin that we want to always use for Excel based documents:
	// BMK_XLSX_PLUG:

	// Dynamic loading of additional plugins requested by the user:
	if ( options.extraPlugs &amp;&amp; typeof options.extraPlugs === 'object' &amp;&amp; options.extraPlugs.forEach ) {
		options.extraPlugs.forEach ( function ( value ) {
			var newPlug;

			if ( value ) {
				if ( typeof value === 'function' ) {
					// You already loaded the plugin:
					newPlug = value;

				} else if ( typeof value === 'string' ) {
					// We need to load the plugin:
					newPlug = require ( './' + value );
				} // Endif.
			} // Endif.

			plugsmanObj.plugsList.push ( new newPlug ( plugsmanObj ) );
		});
	} // Endif.

	gen_private.type.msoffice.files_list.push (
		{
			name: '/xl/styles.xml',
			type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml',
			clear: 'type'
		},
		{
			name: '/xl/workbook.xml',
			type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml',
			clear: 'type'
		}
	);

	gen_private.type.msoffice.rels_app.push (
		{
			type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles',
			target: 'styles.xml',
			clear: 'type'
		},
		{
			type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme',
			target: 'theme/theme1.xml',
			clear: 'type'
		}
	);

	gen_private.plugs.intAddAnyResourceToParse ( 'docProps\\app.xml', 'buffer', null, cbMakeXlsApp, true );
	gen_private.plugs.intAddAnyResourceToParse ( 'xl\\styles.xml', 'buffer', null, cbMakeXlsStyles, true );
	gen_private.plugs.intAddAnyResourceToParse ( 'xl\\workbook.xml', 'buffer', null, cbMakeXlsWorkbook, true );

	gen_private.plugs.intAddAnyResourceToParse ( 'xl\\_rels\\workbook.xml.rels', 'buffer', gen_private.type.msoffice.rels_app, gen_private.plugs.type.msoffice.cbMakeRels, true );

	// ----- API for Excel documents: -----

	/**
	 * Create a new sheet.
	 *
	 * This method creating a new Excel sheet.
	 */
	genobj.makeNewSheet = function () {
		var pageNumber = gen_private.pages.length;
		var sheetObj = {}; // The sheet object that the user will use.

		sheetObj.data = []; // Place here all the data.

		gen_private.pages[pageNumber] = {};
		gen_private.pages[pageNumber].id = pageNumber;
		gen_private.pages[pageNumber].relId = gen_private.type.msoffice.rels_app.length + 1;
		gen_private.pages[pageNumber].sheet = sheetObj;

		gen_private.type.msoffice.rels_app.push (
			{
				type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet',
				target: 'worksheets/sheet' + (pageNumber + 1) + '.xml',
				clear: 'data'
			}
		);

		gen_private.type.msoffice.files_list.push (
			{
				name: '/xl/worksheets/sheet' + (pageNumber + 1) + '.xml',
				type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml',
				clear: 'data'
			}
		);

		sheetObj.setCell = function ( position, data_val ) {
			var rel_pos = cbCellToNumber ( position, true );

			if ( !sheetObj.data[rel_pos.row] ) {
				sheetObj.data[rel_pos.row] = [];
			} // Endif.

			sheetObj.data[rel_pos.row][rel_pos.column] = data_val;
		};

		gen_private.plugs.intAddAnyResourceToParse ( 'xl\\worksheets\\sheet' + (pageNumber + 1) + '.xml', 'buffer', gen_private.pages[pageNumber], cbMakeXlsSheet, false );

		// Signal to the plugins about a new sheet:
		gen_private.features.type.xlsx.emitEvent ( 'newPage', { genobj: genobj, page: sheetObj, pageData: gen_private.pages[pageNumber], pageNumber: pageNumber } );

		return sheetObj;
	};

	// Tell all the features (plugins) to add extra API:
	gen_private.features.type.xlsx.emitEvent ( 'makeDocApi', genobj );

	return this;
}

baseobj.plugins.registerDocType ( 'xlsx', makeXlsx, {}, baseobj.docType.SPREADSHEET, "Microsoft Excel Document" );

</code></pre>
        </article>
    </section>






        

        <footer>
            Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.1</a> on Sun Feb 05 2017 05:03:39 GMT+0100 (W. Europe Standard Time)
        </footer>
    </div>
</div>
<script>prettyPrint();</script>
<script src="scripts/jaguar.js"></script>
</body>
</html>
