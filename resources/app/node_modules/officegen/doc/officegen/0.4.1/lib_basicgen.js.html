<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Source: lib/basicgen.js</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/jaguar.css">
    
    
    <script>
    var config = {"monospaceLinks":false,"cleverLinks":false,"default":{"outputSourceFiles":true}};
    </script>
    

    
</head>
<body>
<div id="wrap" class="clearfix">
    
<div class="navigation">
    <h3 class="applicationName"><a href="index.html"></a></h3>

    <div class="search">
        <input id="search" type="text" class="form-control input-sm" placeholder="Search Documentations">
    </div>
    <ul class="list">
    
        <li class="item" data-name="gruntfile">
            <span class="title">
                <a href="gruntfile.html">gruntfile</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="gruntfile.default"><a href="gruntfile.html#.default">default</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="officegen#plugins">
            <span class="title">
                <a href="officegen_plugins.html">officegen#plugins</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="officegen#plugins.getDocTypeByName"><a href="officegen_plugins.html#.getDocTypeByName">getDocTypeByName</a></li>
            
                <li data-name="officegen#plugins.getPrototypeByName"><a href="officegen_plugins.html#.getPrototypeByName">getPrototypeByName</a></li>
            
                <li data-name="officegen#plugins.getVerboseMode"><a href="officegen_plugins.html#.getVerboseMode">getVerboseMode</a></li>
            
                <li data-name="officegen#plugins.registerDocType"><a href="officegen_plugins.html#.registerDocType">registerDocType</a></li>
            
                <li data-name="officegen#plugins.registerParserType"><a href="officegen_plugins.html#.registerParserType">registerParserType</a></li>
            
                <li data-name="officegen#plugins.registerPrototype"><a href="officegen_plugins.html#.registerPrototype">registerPrototype</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="officegen#private">
            <span class="title">
                <a href="officegen_private.html">officegen#private</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="officegen#private#plugs">
            <span class="title">
                <a href="officegen_private_plugs.html">officegen#private#plugs</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="officegen#private#plugs.type"><a href="officegen_private_plugs.html#.type">type</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="officegen#private#plugs.intAddAnyResourceToParse"><a href="officegen_private_plugs.html#.intAddAnyResourceToParse">intAddAnyResourceToParse</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="makedocpluginapi">
            <span class="title">
                <a href="makedocpluginapi.html">makedocpluginapi</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="makedocpluginapi#emitEvent"><a href="makedocpluginapi.html#emitEvent">emitEvent</a></li>
            
                <li data-name="makedocpluginapi#getDataStorage"><a href="makedocpluginapi.html#getDataStorage">getDataStorage</a></li>
            
                <li data-name="makedocpluginapi#getFeaturesStorage"><a href="makedocpluginapi.html#getFeaturesStorage">getFeaturesStorage</a></li>
            
                <li data-name="makedocpluginapi#getVerboseMode"><a href="makedocpluginapi.html#getVerboseMode">getVerboseMode</a></li>
            
                <li data-name="makedocpluginapi#logIfVerbose"><a href="makedocpluginapi.html#logIfVerbose">logIfVerbose</a></li>
            
                <li data-name="makedocpluginapi#registerCallback"><a href="makedocpluginapi.html#registerCallback">registerCallback</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="makeDocx">
            <span class="title">
                <a href="makeDocx.html">makeDocx</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="makeDocx~cbMakeDocxApp"><a href="makeDocx.html#~cbMakeDocxApp">cbMakeDocxApp</a></li>
            
                <li data-name="makeDocx~cbMakeDocxDocument"><a href="makeDocx.html#~cbMakeDocxDocument">cbMakeDocxDocument</a></li>
            
                <li data-name="makeDocx~cbMakeDocxFontsTable"><a href="makeDocx.html#~cbMakeDocxFontsTable">cbMakeDocxFontsTable</a></li>
            
                <li data-name="makeDocx~cbMakeDocxSettings"><a href="makeDocx.html#~cbMakeDocxSettings">cbMakeDocxSettings</a></li>
            
                <li data-name="makeDocx~cbMakeDocxStyles"><a href="makeDocx.html#~cbMakeDocxStyles">cbMakeDocxStyles</a></li>
            
                <li data-name="makeDocx~cbMakeDocxWeb"><a href="makeDocx.html#~cbMakeDocxWeb">cbMakeDocxWeb</a></li>
            
                <li data-name="makeDocx~cbPrepareDocxToGenerate"><a href="makeDocx.html#~cbPrepareDocxToGenerate">cbPrepareDocxToGenerate</a></li>
            
                <li data-name="makeDocx~setDefaultDocValues"><a href="makeDocx.html#~setDefaultDocValues">setDefaultDocValues</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="makelayoutplugin">
            <span class="title">
                <a href="makelayoutplugin.html">makelayoutplugin</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="makelayoutplugin#beforeGen"><a href="makelayoutplugin.html#beforeGen">beforeGen</a></li>
            
                <li data-name="makelayoutplugin#extendPptxApi"><a href="makelayoutplugin.html#extendPptxApi">extendPptxApi</a></li>
            
                <li data-name="makelayoutplugin#extendPptxSlideApi"><a href="makelayoutplugin.html#extendPptxSlideApi">extendPptxSlideApi</a></li>
            
                <li data-name="makelayoutplugin#setData"><a href="makelayoutplugin.html#setData">setData</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="makemsdoc">
            <span class="title">
                <a href="makemsdoc.html">makemsdoc</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="makemsdoc~cbMakeCore"><a href="makemsdoc.html#~cbMakeCore">cbMakeCore</a></li>
            
                <li data-name="makemsdoc~cbMakeMainFilesList"><a href="makemsdoc.html#~cbMakeMainFilesList">cbMakeMainFilesList</a></li>
            
                <li data-name="makemsdoc~cbMakeTheme"><a href="makemsdoc.html#~cbMakeTheme">cbMakeTheme</a></li>
            
                <li data-name="makemsdoc~cbOfficeClearAfterGenerate"><a href="makemsdoc.html#~cbOfficeClearAfterGenerate">cbOfficeClearAfterGenerate</a></li>
            
                <li data-name="makemsdoc~cbOfficeClearDocData"><a href="makemsdoc.html#~cbOfficeClearDocData">cbOfficeClearDocData</a></li>
            
                <li data-name="makemsdoc~clearSmartArrayFromType"><a href="makemsdoc.html#~clearSmartArrayFromType">clearSmartArrayFromType</a></li>
            
                <li data-name="makemsdoc~compactArray"><a href="makemsdoc.html#~compactArray">compactArray</a></li>
            
                <li data-name="makemsdoc~getCurDateTimeForOffice"><a href="makemsdoc.html#~getCurDateTimeForOffice">getCurDateTimeForOffice</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="makeoodoc">
            <span class="title">
                <a href="makeoodoc.html">makeoodoc</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="makeoodoc~makeOpenOfficeMimeType"><a href="makeoodoc.html#~makeOpenOfficeMimeType">makeOpenOfficeMimeType</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="makePptx">
            <span class="title">
                <a href="makePptx.html">makePptx</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="makePptx~cbGenerateEffects"><a href="makePptx.html#~cbGenerateEffects">cbGenerateEffects</a></li>
            
                <li data-name="makePptx~cbMakeCharts"><a href="makePptx.html#~cbMakeCharts">cbMakeCharts</a></li>
            
                <li data-name="makePptx~cbMakePptxApp"><a href="makePptx.html#~cbMakePptxApp">cbMakePptxApp</a></li>
            
                <li data-name="makePptx~cbMakePptxLayout"><a href="makePptx.html#~cbMakePptxLayout">cbMakePptxLayout</a></li>
            
                <li data-name="makePptx~cbMakePptxPresentation"><a href="makePptx.html#~cbMakePptxPresentation">cbMakePptxPresentation</a></li>
            
                <li data-name="makePptx~cbMakePptxPresProps"><a href="makePptx.html#~cbMakePptxPresProps">cbMakePptxPresProps</a></li>
            
                <li data-name="makePptx~cbMakePptxSlide"><a href="makePptx.html#~cbMakePptxSlide">cbMakePptxSlide</a></li>
            
                <li data-name="makePptx~cbMakePptxSlideMasters"><a href="makePptx.html#~cbMakePptxSlideMasters">cbMakePptxSlideMasters</a></li>
            
                <li data-name="makePptx~cbMakePptxStyles"><a href="makePptx.html#~cbMakePptxStyles">cbMakePptxStyles</a></li>
            
                <li data-name="makePptx~cbMakePptxViewProps"><a href="makePptx.html#~cbMakePptxViewProps">cbMakePptxViewProps</a></li>
            
                <li data-name="makePptx~cbPreparePptxToGenerate"><a href="makePptx.html#~cbPreparePptxToGenerate">cbPreparePptxToGenerate</a></li>
            
                <li data-name="makePptx~cMakePptxColorSelection"><a href="makePptx.html#~cMakePptxColorSelection">cMakePptxColorSelection</a></li>
            
                <li data-name="makePptx~cMakePptxOutTextCommand"><a href="makePptx.html#~cMakePptxOutTextCommand">cMakePptxOutTextCommand</a></li>
            
                <li data-name="makePptx~cMakePptxOutTextData"><a href="makePptx.html#~cMakePptxOutTextData">cMakePptxOutTextData</a></li>
            
                <li data-name="makePptx~createBodyProperties"><a href="makePptx.html#~createBodyProperties">createBodyProperties</a></li>
            
                <li data-name="makePptx~CreateFieldText"><a href="makePptx.html#~CreateFieldText">CreateFieldText</a></li>
            
                <li data-name="makePptx~getShapeInfo"><a href="makePptx.html#~getShapeInfo">getShapeInfo</a></li>
            
                <li data-name="makePptx~parseSmartNumber"><a href="makePptx.html#~parseSmartNumber">parseSmartNumber</a></li>
            
                <li data-name="makePptx~setDefaultDocValues"><a href="makePptx.html#~setDefaultDocValues">setDefaultDocValues</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="makespknotesplugin">
            <span class="title">
                <a href="makespknotesplugin.html">makespknotesplugin</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="makespknotesplugin#beforeGen"><a href="makespknotesplugin.html#beforeGen">beforeGen</a></li>
            
                <li data-name="makespknotesplugin#cbMakePptxNotesMasters"><a href="makespknotesplugin.html#cbMakePptxNotesMasters">cbMakePptxNotesMasters</a></li>
            
                <li data-name="makespknotesplugin#cbMakePptxSpkNote"><a href="makespknotesplugin.html#cbMakePptxSpkNote">cbMakePptxSpkNote</a></li>
            
                <li data-name="makespknotesplugin#cbMakeTheme2"><a href="makespknotesplugin.html#cbMakeTheme2">cbMakeTheme2</a></li>
            
                <li data-name="makespknotesplugin#extendPptxSlideApi"><a href="makespknotesplugin.html#extendPptxSlideApi">extendPptxSlideApi</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="makewidescreenplugin">
            <span class="title">
                <a href="makewidescreenplugin.html">makewidescreenplugin</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="makewidescreenplugin#extendPptxApi"><a href="makewidescreenplugin.html#extendPptxApi">extendPptxApi</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="makeXlsx">
            <span class="title">
                <a href="makeXlsx.html">makeXlsx</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="makeXlsx~cbCellToNumber"><a href="makeXlsx.html#~cbCellToNumber">cbCellToNumber</a></li>
            
                <li data-name="makeXlsx~cbMakeXlsApp"><a href="makeXlsx.html#~cbMakeXlsApp">cbMakeXlsApp</a></li>
            
                <li data-name="makeXlsx~cbMakeXlsSharedStrings"><a href="makeXlsx.html#~cbMakeXlsSharedStrings">cbMakeXlsSharedStrings</a></li>
            
                <li data-name="makeXlsx~cbMakeXlsSheet"><a href="makeXlsx.html#~cbMakeXlsSheet">cbMakeXlsSheet</a></li>
            
                <li data-name="makeXlsx~cbMakeXlsStyles"><a href="makeXlsx.html#~cbMakeXlsStyles">cbMakeXlsStyles</a></li>
            
                <li data-name="makeXlsx~cbMakeXlsWorkbook"><a href="makeXlsx.html#~cbMakeXlsWorkbook">cbMakeXlsWorkbook</a></li>
            
                <li data-name="makeXlsx~cbNumberToCell"><a href="makeXlsx.html#~cbNumberToCell">cbNumberToCell</a></li>
            
                <li data-name="makeXlsx~cbPrepareXlsxToGenerate"><a href="makeXlsx.html#~cbPrepareXlsxToGenerate">cbPrepareXlsxToGenerate</a></li>
            
                <li data-name="makeXlsx~setDefaultDocValues"><a href="makeXlsx.html#~setDefaultDocValues">setDefaultDocValues</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="officegen">
            <span class="title">
                <a href="officegen.html">officegen</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="officegen#addResourceToParse"><a href="officegen.html#addResourceToParse">addResourceToParse</a></li>
            
                <li data-name="officegen#generate"><a href="officegen.html#generate">generate</a></li>
            
                <li data-name="officegen#startNewDoc"><a href="officegen.html#startNewDoc">startNewDoc</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
    </ul>
</div>
    <div class="main">
        <h1 class="page-title" data-filename="lib_basicgen.js.html">Source: lib/basicgen.js</h1>
        


    
    <section>
        <article>
            <pre id="source-code" class="prettyprint source "><code>//
// officegen: basic common code
//
// Please refer to README.md for this module's documentations.
//
// NOTE:
// - Before changing this code please refer to the hacking the code section on README.md.
//
// Copyright (c) 2013 Ziv Barber;
//
// Permission is hereby granted, free of charge, to any person obtaining
// a copy of this software and associated documentation files (the
// 'Software'), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to
// permit persons to whom the Software is furnished to do so, subject to
// the following conditions:
//
// The above copyright notice and this permission notice shall be
// included in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,
// EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
// IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
// CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
// TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
// SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
//

require("setimmediate"); // To be compatible with all versions of node.js

(function () {

var sys = require('util');
var events = require('events');

var Transform = require('stream').Transform || require('readable-stream/transform');

// Used by generate:
var archiver = require('archiver');
var fs = require('fs');
var PassThrough = require('stream').PassThrough || require('readable-stream/passthrough');

// Global data shared by all the officegen objects:

var officegenGlobals = {}; // Our internal global objects.

officegenGlobals.settings = {};
officegenGlobals.types = {};
officegenGlobals.docPrototypes = {};
officegenGlobals.resParserTypes = {};

/**
 * The constructor of the office generator object.
 * &lt;br />&lt;br />
 * This constructor function is been called by makegen().
 *
 * &lt;h3>&lt;b>The options:&lt;/b>&lt;/h3>
 *
 * The configuration options effecting the operation of the officegen object. Some of them can be only been 
 * declared on the 'options' object passed to the constructor object and the rest can be configured by either 
 * a property with the same name or by special function.
 *
 * &lt;h3>&lt;b>List of options:&lt;/b>&lt;/h3>
 *
 * &lt;ul>
 * &lt;li>'type' - the type of generator to create. Possible options: either 'pptx', 'docx' or 'xlsx'.&lt;/li>
 * &lt;li>'creator' - the name of the document's author. The default is 'officegen'.&lt;/li>
 * &lt;li>'onend' - callback that been fired after finishing to create the zip stream.&lt;/li>
 * &lt;li>'onerr' - callback that been fired on error.&lt;/li>
 * &lt;/ul>
 *
 * @param {object} options List of configuration options (see in the description of this function).
 * @constructor
 * @name officegen
 */
var officegen = function ( options ) {
    if ( false === ( this instanceof officegen )) {
		return new officegen ( options );
	} // Endif.

	events.EventEmitter.call ( this );
	// Transform.call ( this, { objectMode : true } );

	// Internal events for plugins - NOT for the user:
	// event 'beforeGen'
	// event 'afterGen'
	// event 'clearDoc'

	var genobj = this;    // Can be accessed by all the functions been declared inside the officegen object.

	/**
	 * For all the private data of each officegen instance that we don't want the user of officegen to access it.
	 * Each officegen object has it's own copy of the private object so changes been done to the private object of one officegen document will not effect other objects.
	 * &lt;br />&lt;br />
	 * List of data members:
	 * &lt;ul>
	 * &lt;li>features (object) - ???.&lt;/li>
	 * &lt;ul>
	 * &lt;li>type&lt;/li>
	 * &lt;li>outputType (string) - The type of the container to hold all the resources.&lt;/li>
	 * &lt;/ul>
	 * &lt;li>pages&lt;/li>
	 * &lt;li>resources&lt;/li>
	 * &lt;li>type&lt;/li>
	 * &lt;li>plugs&lt;/li>
	 * &lt;li>length&lt;/li>
	 * &lt;/ul>
	 * @namespace officegen#private
	 */
	var privateData = {};

	// Features been configured by the type selector and you can't change them:
	privateData.features = {};
	privateData.features.type = {};
	privateData.features.outputType = 'zip';
	// privateData.features.page_name

	// Resources and "pages" of the document:
	privateData.pages = []; // Information about all the pages to create.
	privateData.resources = []; // List of all the resources to create inside the zip.

	// Extra data needed by the document and it's specific to either to "document prototype" (like MS-office) or a document type (like pptx):
	privateData.type = {};

	/**
	 * Combine the given options and the default values.
	 * &lt;br />&lt;br />
	 * 
	 * This function creating the real options object.
	 * 
	 * @param {object} options The options to configure.
	 */
	function setOptions ( object, source ) {
		object = object || {};

		var objectTypes = {
			'boolean': false,
			'function': true,
			'object': true,
			'number': false,
			'string': false,
			'undefined': false
		};

		function isObject (value) {
			return !!(value &amp;&amp; objectTypes[typeof value]);
		}

		function keys (object) {
			if (!isObject(object)) {
				return [];
			}

			return Object.keys(object);
		}

		var index;
		var iterable = object;
		var result = iterable;

		var args = arguments;
		var argsIndex = 0;
		var argsLength = args.length;

	        //loop variables 
		var ownIndex = -1;
		var ownProps = objectTypes[typeof iterable] &amp;&amp; keys(iterable);
		var length = ownProps ? ownProps.length : 0;
	    
		while (++argsIndex &lt; argsLength) {
			iterable = args[argsIndex];

			if (iterable &amp;&amp; objectTypes[typeof iterable]) {

				while (++ownIndex &lt; length) {
					index = ownProps[ownIndex];

					if (typeof result[index] === 'undefined' || result[index] === null) {
						result[index] = iterable[index];

					} else if (isObject(result[index]) &amp;&amp; isObject(iterable[index])) {
						result[index] = setOptions(result[index], iterable[index]);
					} // Endif.
				} // End of while loop.
			} // Endif.
		} // End of while loop.

		return result;
	}

	/**
	 * Configure this object to generate the given type of document.
	 * &lt;br />&lt;br />
	 * 
	 * Called by the document constructor to configure the new document object to the given type.
	 * 
	 * @param {string} new_type The type of document to create.
	 */
	function setGeneratorType ( new_type ) {
		privateData.length = 0;
		var is_ok = false;

		if ( new_type ) {
			for ( var cur_type in officegenGlobals.types ) {
				if ( (cur_type == new_type) &amp;&amp; officegenGlobals.types[cur_type] &amp;&amp; officegenGlobals.types[cur_type].createFunc ) {
					officegenGlobals.types[cur_type].createFunc ( genobj, new_type, genobj.options, privateData, officegenGlobals.types[cur_type] );
					is_ok = true;
					break;
				} // Endif.
			} // End of for loop.

			if ( !is_ok ) {
				// console.error ( '\nFATAL ERROR: Either unknown or unsupported file type - %s\n', options.type );
				genobj.emit ( 'error', 'FATAL ERROR: Invalid file type.' );
			} // Endif.
		} // Endif.
	}

	/**
	 * API for plugins.
	 * &lt;br />&lt;br />
	 * Officegen plugins can extend officegen to support more document formats.
	 * &lt;br />&lt;br />
	 * Examples how to do it can be found on lib/gendocx.js, lib/genpptx.js and lib/genxlsx.js.
	 * @namespace officegen#private#plugs
	 * @example &lt;caption>Adding a new document type to officegen&lt;/caption>
	 * var baseobj = require ( "officegen" );
	 *
	 * function makeMyDoc ( officegenObj, typeCodeName, options, officegenObjPlugins, typeInfo ) {
	 * 	// officegenObjPlugins = Plugins access to extend officegenObj.
	 * }
	 *
	 * baseobj.plugins.registerDocType (
	 * 	'mydoctype', // The document type's code name.
	 * 	makeMyDoc,
	 * 	{},
	 * 	baseobj.docType.TEXT,
	 * 	"My Special Document File Format"
	 * );
	 */
	privateData.plugs = {
		/**
		 * Add a resource to the list of resources to place inside the output zip file.
		 * &lt;br />&lt;br />
		 * 
		 * This method adding a resource to the list of resources to place inside the output document ZIP.
		 * &lt;br />
		 * Changed by vtloc in 2014Jan10.
		 * 
		 * @param {string} resource_name The name of the resource (path).
		 * @param {string} type_of_res The type of this resource: either 'file', 'buffer', 'stream' or 'officegen' (the last one allow you to put office document inside office document).
		 * @param {object} res_data Optional data to use when creating this resource.
		 * @param {function} res_cb Callback to generate this resource (for 'buffer' mode only).
		 * @param {boolean} is_always Is true if this resource is perment for all the zip of this document type.
		 * @param {boolean} removed_after_used Is true if we need to delete this file after used.
		 * @memberof officegen#private#plugs
		 */
		intAddAnyResourceToParse: function ( resource_name, type_of_res, res_data, res_cb, is_always, removed_after_used ) {
			var newRes = {};

			newRes.name = resource_name;
			newRes.type = type_of_res;
			newRes.data = res_data;
			newRes.callback = res_cb;
			newRes.is_perment = is_always;
		
			// delete the temporatory resources after used
			// @author vtloc
			// @date 2014Jan10
			if ( removed_after_used ) {
				newRes.removed_after_used = removed_after_used;

			} else {
				newRes.removed_after_used = false;
			} // Endif.

			if ( officegenGlobals.settings.verbose ) {
				console.log("[officegen] Push new res : ", newRes);
			} // Endif.

			privateData.resources.push ( newRes );
		},

		/**
		 * Any additional plugin API must be placed here.
		 * @memberof officegen#private#plugs
		 */
		type: {}
	};

	// Public API:

	/**
	 * Generating the output document stream.
	 * &lt;br />&lt;br />
	 * 
	 * The user of officegen must call this method after filling all the information about what to put inside 
	 * the generated document. This method is creating the output document directly into the given stream object.
	 * 
	 * The options parameters properties:
	 * 
	 * 'finalize' - callback to be called after finishing to generate the document.
	 * 'error' - callback to be called on error.
	 * 
	 * @param {object} output_stream The stream to receive the generated document.
	 * @param {object} options Way to pass callbacks.
	 * @function generate
	 * @memberof officegen
	 * @instance
	 */
	this.generate = function ( output_stream, options ) {
		if ( officegenGlobals.settings.verbose ) {
			console.log("[officegen] Start generate() : ", {outputType: privateData.features.outputType });
		}

		if ( typeof options == 'object' ) {
			if ( options.finalize ) {
				genobj.on ( 'finalize', options.finalize );
			} // Endif.

			if ( options.error ) {
				genobj.on ( 'error', options.error );
			} // Endif.
		} // Endif.

		if ( privateData.features.page_name ) {
			if ( privateData.pages.length == 0 ) {
				genobj.emit ( 'error', 'ERROR: No ' + privateData.features.page_name + ' been found inside your document.' );
			} // Endif.
		} // Endif.

		// Allow the type generator to prepare everything:
		genobj.emit ( 'beforeGen', privateData );

		var archive = archiver( privateData.features.outputType == 'zip' ? 'zip' : 'tar' );

		/**
		 * Error handler.
		 * &lt;br />&lt;br />
		 * 
		 * This is our error handler method for creating archive.
		 * 
		 * @param {string} err The error string.
		 */
		function onArchiveError ( err ) {
			genobj.emit ( 'error', err );
		}

		archive.on ( 'error', onArchiveError );

		if ( privateData.features.outputType == 'gzip' ) {
			var zlib = require('zlib');
			var gzipper = zlib.createGzip ();

			archive.pipe ( gzipper ).pipe ( output_stream );

		} else {
			archive.pipe ( output_stream );
		} // Endif.

		/**
		 * Add the next resource into the zip stream.
		 * &lt;br />&lt;br />
		 * 
		 * This function adding the next resource into the zip stream.
		 */
		function generateNextResource ( cur_index )
		{
			if ( officegenGlobals.settings.verbose ) {
				console.log("[officegen] generateNextResource("+cur_index+") : ", privateData.resources[cur_index]);
			}

			var resStream;

			if ( cur_index &lt; privateData.resources.length ) {
				if ( typeof privateData.resources[cur_index] != 'undefined' ) {
					switch ( privateData.resources[cur_index].type ) {
						// Generate the resource text data by calling to provided function:
						case 'buffer':
							resStream = privateData.resources[cur_index].callback ( privateData.resources[cur_index].data );
							break;

						// Just copy the file as is:
						case 'file':
							resStream = fs.createReadStream ( privateData.resources[cur_index].data || privateData.resources[cur_index].name );
							break;

						// Just use this stream:
						case 'stream':
							resStream = privateData.resources[cur_index].data;
							break;

						// Officegen object:
						case 'officegen':
							resStream = new PassThrough ();
							privateData.resources[cur_index].data.generate ( resStream );
							break;

						// Custom parser:
						default:
							for ( var cur_parserType in officegenGlobals.resParserTypes ) {
								if ( (cur_parserType == privateData.resources[cur_index].type) &amp;&amp; officegenGlobals.resParserTypes[cur_parserType] &amp;&amp; officegenGlobals.resParserTypes[cur_parserType].parserFunc ) {
									resStream = officegenGlobals.resParserTypes[cur_parserType].parserFunc (
										genobj,
										privateData.resources[cur_index].name,
										privateData.resources[cur_index].callback, // Can be used as the template source for template engines.
										privateData.resources[cur_index].data,     // The data for the template engine.
										officegenGlobals.resParserTypes[cur_parserType].extra_data
									);
									break;
								} // Endif.
							} // End of for loop.
					} // End of switch.

					if ( typeof resStream != 'undefined' ) {
						if ( officegenGlobals.settings.verbose ) {
							console.log ( '[officegen] Adding into archive : "' + privateData.resources[cur_index].name + '" (' + privateData.resources[cur_index].type + ')...' );
						} // Endif.

						archive.append ( resStream, { name: privateData.resources[cur_index].name } );

						generateNextResource ( cur_index + 1 );

					} else {
						if ( officegenGlobals.settings.verbose ) {
							console.log("[officegen] resStream is undefined");   // is it normal ??
						}
						generateNextResource ( cur_index + 1 );
						// setImmediate ( function() { generateNextResource ( cur_index + 1 ); });
					} // Endif.
          
				} else {
					// Removed resource - just ignore it:
					generateNextResource ( cur_index + 1 );
					// setImmediate ( function() { generateNextResource ( cur_index + 1 ); });
				} // Endif.

			} else {
				// now we can remove all temporary resources
				privateData.resources.forEach(function (resource) {
					if (resource.removed_after_used){
						var filename = resource.data || resource.name;

						if ( officegenGlobals.settings.verbose ) {
							console.log("[officegen] Removing resource: ", filename);
						}

						fs.unlinkSync(filename);
					}
				});

				// No more resources to add - close the archive:
				if ( officegenGlobals.settings.verbose ) {
					console.log("[officegen] Finalizing archive ...");
				}
				archive.finalize ();

				// Event to the type generator:
				genobj.emit ( 'afterGen', privateData, null, archive.pointer () );

				genobj.emit ( 'finalize', archive.pointer () );
			} // Endif.
		}

		// Start the process of generating the output zip stream:
		generateNextResource ( 0 );
	};

	/**
	 * Reuse this object for a new document of the same type.
	 * &lt;br />&lt;br />
	 * 
	 * Call this method if you want to start generating a new document of the same type using this object.
	 * @function startNewDoc
	 * @memberof officegen
	 * @instance
	 */
	this.startNewDoc = function () {
		var kill = [];

		for ( var i = 0; i &lt; privateData.resources.length; i++ ) {
			if ( !privateData.resources[i].is_perment ) kill.push ( i );
		} // End of for loop.

		for ( var i = 0; i &lt; kill.length; i++ ) privateData.resources.splice ( kill[i] - i, 1 );

		privateData.pages.length = 0;

		genobj.emit ( 'clearDoc', privateData );
	};

	// Public API - plugin API:

	/**
	 * Register a new resource to add into the generated ZIP stream.
	 * &lt;br />&lt;br />
	 * 
	 * Using this method the user can add extra custom resources into the generated ZIP stream.
	 * 
	 * @param {string} resource_name The name of the resource (path).
	 * @param {string} type_of_res The type of this resource: either 'file' or 'buffer'.
	 * @param {object} res_data Optional data to use when creating this resource.
	 * @param {function} res_cb Callback to generate this resource (for 'buffer' mode only).
	 * @function addResourceToParse
	 * @memberof officegen
	 * @instance
	 */
	this.addResourceToParse = function ( resource_name, type_of_res, res_data, res_cb ) {
		// We don't want the user to add permanent resources to the list of resources:
		privateData.plugs.intAddAnyResourceToParse ( resource_name, type_of_res, res_data, res_cb, false );
	};

	if ( typeof options == 'string' ) {
		options = { 'type': options };
	} // Endif.

	// See the officegen descriptions for the rules of the options:
	genobj.options = setOptions ( options, { 'type': 'unknown' } );

	if ( genobj.options &amp;&amp; genobj.options.onerr ) {
		genobj.on ( 'error', genobj.options.onerr );
	} // Endif.

	if ( genobj.options &amp;&amp; genobj.options.onend ) {
		genobj.on ( 'finalize', genobj.options.onend );
	} // Endif.
	
	// Configure this object depending on the user's selected type:
	if ( genobj.options.type ) {
		setGeneratorType ( genobj.options.type );
	} // Endif.

	return this;
};

sys.inherits ( officegen, events.EventEmitter );

/**
 * Create a new officegen object.
 * &lt;br />&lt;br />
 * 
 * This method creating a new officegen based object.
 */
module.exports = function ( options ) {
	return new officegen ( options );
};

/**
 * Change the verbose state of officegen.
 * &lt;br />&lt;br />
 * 
 * This is a global settings effecting all the officegen objects in your application. You should 
 * use it only for debugging.
 * 
 * @param {boolean} new_state Either true or false.
 */
module.exports.setVerboseMode = function setVerboseMode ( new_state ) {
	officegenGlobals.settings.verbose = new_state;
}

/**
 * Plugin API effecting all the instances of the officegen object.
 *
 * @namespace officegen#plugins
 */
var plugins = {
	/**
	 * Register a new type of document that we can generate.
	 * &lt;br />&lt;br />
	 * 
	 * This method registering a new type of document that we can generate. You can extend officegen to support any 
	 * type of document that based on resources files inside ZIP stream.
	 * 
	 * @param {string} typeName The type of the document file.
	 * @param {function} createFunc The function to use to create this type of file.
	 * @param {object} schema_data Information needed by Schema-API to generate this kind of document.
	 * @param {string} docType Document type.
	 * @param {string} displayName The display name of this type.
	 * @memberof officegen#plugins
	 */
	registerDocType: function ( typeName, createFunc, schema_data, docType, displayName ) {
		officegenGlobals.types[typeName] = {};
		officegenGlobals.types[typeName].createFunc = createFunc;
		officegenGlobals.types[typeName].schema_data = schema_data;
		officegenGlobals.types[typeName].type = docType;
		officegenGlobals.types[typeName].display = displayName;
	},

	/**
	 * Get a document type object by name.
	 * &lt;br />&lt;br />
	 * 
	 * This method get a document type object.
	 * 
	 * @param {string} typeName The name of the document type.
	 * @return The plugin object of the document type.
	 * @memberof officegen#plugins
	 */
	getDocTypeByName: function ( typeName ) {
		return officegenGlobals.types[typeName];
	},

	/**
	 * Register a document prototype object.
	 * &lt;br />&lt;br />
	 * 
	 * This method registering a prototype document object. You can place all the common code needed by a group of document 
	 * types in a single prototype object.
	 * 
	 * @param {string} typeName The name of the prototype object.
	 * @param {object} baseObj The prototype object.
	 * @param {string} displayName The display name of this type.
	 * @memberof officegen#plugins
	 */
	registerPrototype: function ( typeName, baseObj, displayName ) {
		officegenGlobals.docPrototypes[typeName] = {};
		officegenGlobals.docPrototypes[typeName].baseObj = baseObj;
		officegenGlobals.docPrototypes[typeName].display = displayName;
	},

	/**
	 * Get a document prototype object by name.
	 * &lt;br />&lt;br />
	 * 
	 * This method get a prototype object.
	 * 
	 * @param {string} typeName The name of the prototype object.
	 * @return The prototype plugin object.
	 * @memberof officegen#plugins
	 */
	getPrototypeByName: function getPrototypeByName ( typeName ) {
		return officegenGlobals.docPrototypes[typeName];
	},

	/**
	 * Register a new resource parser.
	 * &lt;br />&lt;br />
	 * 
	 * This method registering a new resource parser. One use of this feature is in case that you are developing a new 
	 * type of document and you want to extend officegen to use some kind of template engine as jade, ejs, haml* or CoffeeKup. 
	 * In this case you can use a template engine to generate one or more of the resources inside the output archive. 
	 * Another use of this method is to replace an existing plugin with different implementation.
	 * 
	 * @param {string} typeName The type of the parser plugin.
	 * @param {function} parserFunc The resource generating function.
	 * @param {object} extra_data Optional additional data that may be required by the parser function.
	 * @param {string} displayName The display name of this type.
	 * @memberof officegen#plugins
	 */
	registerParserType: function ( typeName, parserFunc, extra_data, displayName ) {
		officegenGlobals.resParserTypes[typeName] = {};
		officegenGlobals.resParserTypes[typeName].parserFunc = parserFunc;
		officegenGlobals.resParserTypes[typeName].extra_data = extra_data;
		officegenGlobals.resParserTypes[typeName].display = displayName;
	},

	/**
	 * Get if we need verbose mode.
	 * @param {string} docType Optional, Allow filtering by document type.
	 * @param {string} moduleName Optional, Allow filtering by feature / module.
	 * @memberof officegen#plugins
	 */
	getVerboseMode: function ( docType, moduleName ) {
		if ( !docType &amp;&amp; !moduleName ) {
			return officegenGlobals.settings.verbose ? true : false;
		} // Endif.

		var verboseFlag;

		if ( officegenGlobals.settings.verbose &amp;&amp; typeof officegenGlobals.settings.verbose === 'object' ) {
			if ( docType &amp;&amp; officegenGlobals.settings.verbose.docType &amp;&amp; typeof officegenGlobals.settings.verbose.docType === 'object' &amp;&amp; officegenGlobals.settings.verbose.docType.indexOf ) {
				verboseFlag = (officegenGlobals.settings.verbose.docType.indexOf ( docType ) >= 0) ? true : false;
			} // Endif.

			if ( verboseFlag !== false &amp;&amp; moduleName &amp;&amp; officegenGlobals.settings.verbose.moduleName &amp;&amp; typeof officegenGlobals.settings.verbose.moduleName === 'object' &amp;&amp; officegenGlobals.settings.verbose.moduleName.indexOf ) {
				verboseFlag = (officegenGlobals.settings.verbose.moduleName.indexOf ( moduleName ) >= 0) ? true : false;
			} // Endif.
		} // Endif.

		return verboseFlag ? true : false;
	}
};

module.exports.plugins = plugins;

module.exports.schema = officegenGlobals.types;

module.exports.docType = { "TEXT" : 1, "SPREADSHEET" : 2, "PRESENTATION" : 3 };

}) ();
</code></pre>
        </article>
    </section>






        

        <footer>
            Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.1</a> on Sun Feb 05 2017 05:03:38 GMT+0100 (W. Europe Standard Time)
        </footer>
    </div>
</div>
<script>prettyPrint();</script>
<script src="scripts/jaguar.js"></script>
</body>
</html>
