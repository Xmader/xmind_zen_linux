<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Source: lib/msofficegen.js</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/jaguar.css">
    
    
    <script>
    var config = {"monospaceLinks":false,"cleverLinks":false,"default":{"outputSourceFiles":true}};
    </script>
    

    
</head>
<body>
<div id="wrap" class="clearfix">
    
<div class="navigation">
    <h3 class="applicationName"><a href="index.html"></a></h3>

    <div class="search">
        <input id="search" type="text" class="form-control input-sm" placeholder="Search Documentations">
    </div>
    <ul class="list">
    
        <li class="item" data-name="gruntfile">
            <span class="title">
                <a href="gruntfile.html">gruntfile</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="gruntfile.default"><a href="gruntfile.html#.default">default</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="officegen#plugins">
            <span class="title">
                <a href="officegen_plugins.html">officegen#plugins</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="officegen#plugins.getDocTypeByName"><a href="officegen_plugins.html#.getDocTypeByName">getDocTypeByName</a></li>
            
                <li data-name="officegen#plugins.getPrototypeByName"><a href="officegen_plugins.html#.getPrototypeByName">getPrototypeByName</a></li>
            
                <li data-name="officegen#plugins.getVerboseMode"><a href="officegen_plugins.html#.getVerboseMode">getVerboseMode</a></li>
            
                <li data-name="officegen#plugins.registerDocType"><a href="officegen_plugins.html#.registerDocType">registerDocType</a></li>
            
                <li data-name="officegen#plugins.registerParserType"><a href="officegen_plugins.html#.registerParserType">registerParserType</a></li>
            
                <li data-name="officegen#plugins.registerPrototype"><a href="officegen_plugins.html#.registerPrototype">registerPrototype</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="officegen#private">
            <span class="title">
                <a href="officegen_private.html">officegen#private</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="officegen#private#plugs">
            <span class="title">
                <a href="officegen_private_plugs.html">officegen#private#plugs</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="officegen#private#plugs.type"><a href="officegen_private_plugs.html#.type">type</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="officegen#private#plugs.intAddAnyResourceToParse"><a href="officegen_private_plugs.html#.intAddAnyResourceToParse">intAddAnyResourceToParse</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="makedocpluginapi">
            <span class="title">
                <a href="makedocpluginapi.html">makedocpluginapi</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="makedocpluginapi#emitEvent"><a href="makedocpluginapi.html#emitEvent">emitEvent</a></li>
            
                <li data-name="makedocpluginapi#getDataStorage"><a href="makedocpluginapi.html#getDataStorage">getDataStorage</a></li>
            
                <li data-name="makedocpluginapi#getFeaturesStorage"><a href="makedocpluginapi.html#getFeaturesStorage">getFeaturesStorage</a></li>
            
                <li data-name="makedocpluginapi#getVerboseMode"><a href="makedocpluginapi.html#getVerboseMode">getVerboseMode</a></li>
            
                <li data-name="makedocpluginapi#logIfVerbose"><a href="makedocpluginapi.html#logIfVerbose">logIfVerbose</a></li>
            
                <li data-name="makedocpluginapi#registerCallback"><a href="makedocpluginapi.html#registerCallback">registerCallback</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="makeDocx">
            <span class="title">
                <a href="makeDocx.html">makeDocx</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="makeDocx~cbMakeDocxApp"><a href="makeDocx.html#~cbMakeDocxApp">cbMakeDocxApp</a></li>
            
                <li data-name="makeDocx~cbMakeDocxDocument"><a href="makeDocx.html#~cbMakeDocxDocument">cbMakeDocxDocument</a></li>
            
                <li data-name="makeDocx~cbMakeDocxFontsTable"><a href="makeDocx.html#~cbMakeDocxFontsTable">cbMakeDocxFontsTable</a></li>
            
                <li data-name="makeDocx~cbMakeDocxSettings"><a href="makeDocx.html#~cbMakeDocxSettings">cbMakeDocxSettings</a></li>
            
                <li data-name="makeDocx~cbMakeDocxStyles"><a href="makeDocx.html#~cbMakeDocxStyles">cbMakeDocxStyles</a></li>
            
                <li data-name="makeDocx~cbMakeDocxWeb"><a href="makeDocx.html#~cbMakeDocxWeb">cbMakeDocxWeb</a></li>
            
                <li data-name="makeDocx~cbPrepareDocxToGenerate"><a href="makeDocx.html#~cbPrepareDocxToGenerate">cbPrepareDocxToGenerate</a></li>
            
                <li data-name="makeDocx~setDefaultDocValues"><a href="makeDocx.html#~setDefaultDocValues">setDefaultDocValues</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="makelayoutplugin">
            <span class="title">
                <a href="makelayoutplugin.html">makelayoutplugin</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="makelayoutplugin#beforeGen"><a href="makelayoutplugin.html#beforeGen">beforeGen</a></li>
            
                <li data-name="makelayoutplugin#extendPptxApi"><a href="makelayoutplugin.html#extendPptxApi">extendPptxApi</a></li>
            
                <li data-name="makelayoutplugin#extendPptxSlideApi"><a href="makelayoutplugin.html#extendPptxSlideApi">extendPptxSlideApi</a></li>
            
                <li data-name="makelayoutplugin#setData"><a href="makelayoutplugin.html#setData">setData</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="makemsdoc">
            <span class="title">
                <a href="makemsdoc.html">makemsdoc</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="makemsdoc~cbMakeCore"><a href="makemsdoc.html#~cbMakeCore">cbMakeCore</a></li>
            
                <li data-name="makemsdoc~cbMakeMainFilesList"><a href="makemsdoc.html#~cbMakeMainFilesList">cbMakeMainFilesList</a></li>
            
                <li data-name="makemsdoc~cbMakeTheme"><a href="makemsdoc.html#~cbMakeTheme">cbMakeTheme</a></li>
            
                <li data-name="makemsdoc~cbOfficeClearAfterGenerate"><a href="makemsdoc.html#~cbOfficeClearAfterGenerate">cbOfficeClearAfterGenerate</a></li>
            
                <li data-name="makemsdoc~cbOfficeClearDocData"><a href="makemsdoc.html#~cbOfficeClearDocData">cbOfficeClearDocData</a></li>
            
                <li data-name="makemsdoc~clearSmartArrayFromType"><a href="makemsdoc.html#~clearSmartArrayFromType">clearSmartArrayFromType</a></li>
            
                <li data-name="makemsdoc~compactArray"><a href="makemsdoc.html#~compactArray">compactArray</a></li>
            
                <li data-name="makemsdoc~getCurDateTimeForOffice"><a href="makemsdoc.html#~getCurDateTimeForOffice">getCurDateTimeForOffice</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="makeoodoc">
            <span class="title">
                <a href="makeoodoc.html">makeoodoc</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="makeoodoc~makeOpenOfficeMimeType"><a href="makeoodoc.html#~makeOpenOfficeMimeType">makeOpenOfficeMimeType</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="makePptx">
            <span class="title">
                <a href="makePptx.html">makePptx</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="makePptx~cbGenerateEffects"><a href="makePptx.html#~cbGenerateEffects">cbGenerateEffects</a></li>
            
                <li data-name="makePptx~cbMakeCharts"><a href="makePptx.html#~cbMakeCharts">cbMakeCharts</a></li>
            
                <li data-name="makePptx~cbMakePptxApp"><a href="makePptx.html#~cbMakePptxApp">cbMakePptxApp</a></li>
            
                <li data-name="makePptx~cbMakePptxLayout"><a href="makePptx.html#~cbMakePptxLayout">cbMakePptxLayout</a></li>
            
                <li data-name="makePptx~cbMakePptxPresentation"><a href="makePptx.html#~cbMakePptxPresentation">cbMakePptxPresentation</a></li>
            
                <li data-name="makePptx~cbMakePptxPresProps"><a href="makePptx.html#~cbMakePptxPresProps">cbMakePptxPresProps</a></li>
            
                <li data-name="makePptx~cbMakePptxSlide"><a href="makePptx.html#~cbMakePptxSlide">cbMakePptxSlide</a></li>
            
                <li data-name="makePptx~cbMakePptxSlideMasters"><a href="makePptx.html#~cbMakePptxSlideMasters">cbMakePptxSlideMasters</a></li>
            
                <li data-name="makePptx~cbMakePptxStyles"><a href="makePptx.html#~cbMakePptxStyles">cbMakePptxStyles</a></li>
            
                <li data-name="makePptx~cbMakePptxViewProps"><a href="makePptx.html#~cbMakePptxViewProps">cbMakePptxViewProps</a></li>
            
                <li data-name="makePptx~cbPreparePptxToGenerate"><a href="makePptx.html#~cbPreparePptxToGenerate">cbPreparePptxToGenerate</a></li>
            
                <li data-name="makePptx~cMakePptxColorSelection"><a href="makePptx.html#~cMakePptxColorSelection">cMakePptxColorSelection</a></li>
            
                <li data-name="makePptx~cMakePptxOutTextCommand"><a href="makePptx.html#~cMakePptxOutTextCommand">cMakePptxOutTextCommand</a></li>
            
                <li data-name="makePptx~cMakePptxOutTextData"><a href="makePptx.html#~cMakePptxOutTextData">cMakePptxOutTextData</a></li>
            
                <li data-name="makePptx~createBodyProperties"><a href="makePptx.html#~createBodyProperties">createBodyProperties</a></li>
            
                <li data-name="makePptx~CreateFieldText"><a href="makePptx.html#~CreateFieldText">CreateFieldText</a></li>
            
                <li data-name="makePptx~getShapeInfo"><a href="makePptx.html#~getShapeInfo">getShapeInfo</a></li>
            
                <li data-name="makePptx~parseSmartNumber"><a href="makePptx.html#~parseSmartNumber">parseSmartNumber</a></li>
            
                <li data-name="makePptx~setDefaultDocValues"><a href="makePptx.html#~setDefaultDocValues">setDefaultDocValues</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="makespknotesplugin">
            <span class="title">
                <a href="makespknotesplugin.html">makespknotesplugin</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="makespknotesplugin#beforeGen"><a href="makespknotesplugin.html#beforeGen">beforeGen</a></li>
            
                <li data-name="makespknotesplugin#cbMakePptxNotesMasters"><a href="makespknotesplugin.html#cbMakePptxNotesMasters">cbMakePptxNotesMasters</a></li>
            
                <li data-name="makespknotesplugin#cbMakePptxSpkNote"><a href="makespknotesplugin.html#cbMakePptxSpkNote">cbMakePptxSpkNote</a></li>
            
                <li data-name="makespknotesplugin#cbMakeTheme2"><a href="makespknotesplugin.html#cbMakeTheme2">cbMakeTheme2</a></li>
            
                <li data-name="makespknotesplugin#extendPptxSlideApi"><a href="makespknotesplugin.html#extendPptxSlideApi">extendPptxSlideApi</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="makewidescreenplugin">
            <span class="title">
                <a href="makewidescreenplugin.html">makewidescreenplugin</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="makewidescreenplugin#extendPptxApi"><a href="makewidescreenplugin.html#extendPptxApi">extendPptxApi</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="makeXlsx">
            <span class="title">
                <a href="makeXlsx.html">makeXlsx</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="makeXlsx~cbCellToNumber"><a href="makeXlsx.html#~cbCellToNumber">cbCellToNumber</a></li>
            
                <li data-name="makeXlsx~cbMakeXlsApp"><a href="makeXlsx.html#~cbMakeXlsApp">cbMakeXlsApp</a></li>
            
                <li data-name="makeXlsx~cbMakeXlsSharedStrings"><a href="makeXlsx.html#~cbMakeXlsSharedStrings">cbMakeXlsSharedStrings</a></li>
            
                <li data-name="makeXlsx~cbMakeXlsSheet"><a href="makeXlsx.html#~cbMakeXlsSheet">cbMakeXlsSheet</a></li>
            
                <li data-name="makeXlsx~cbMakeXlsStyles"><a href="makeXlsx.html#~cbMakeXlsStyles">cbMakeXlsStyles</a></li>
            
                <li data-name="makeXlsx~cbMakeXlsWorkbook"><a href="makeXlsx.html#~cbMakeXlsWorkbook">cbMakeXlsWorkbook</a></li>
            
                <li data-name="makeXlsx~cbNumberToCell"><a href="makeXlsx.html#~cbNumberToCell">cbNumberToCell</a></li>
            
                <li data-name="makeXlsx~cbPrepareXlsxToGenerate"><a href="makeXlsx.html#~cbPrepareXlsxToGenerate">cbPrepareXlsxToGenerate</a></li>
            
                <li data-name="makeXlsx~setDefaultDocValues"><a href="makeXlsx.html#~setDefaultDocValues">setDefaultDocValues</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="officegen">
            <span class="title">
                <a href="officegen.html">officegen</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="officegen#addResourceToParse"><a href="officegen.html#addResourceToParse">addResourceToParse</a></li>
            
                <li data-name="officegen#generate"><a href="officegen.html#generate">generate</a></li>
            
                <li data-name="officegen#startNewDoc"><a href="officegen.html#startNewDoc">startNewDoc</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
    </ul>
</div>
    <div class="main">
        <h1 class="page-title" data-filename="lib_msofficegen.js.html">Source: lib/msofficegen.js</h1>
        


    
    <section>
        <article>
            <pre id="source-code" class="prettyprint source "><code>//
// officegen: basic Microsoft Office common code
//
// Please refer to README.md for this module's documentations.
//
// NOTE:
// - Before changing this code please refer to the hacking the code section on README.md.
//
// Copyright (c) 2013 Ziv Barber;
//
// Permission is hereby granted, free of charge, to any person obtaining
// a copy of this software and associated documentation files (the
// 'Software'), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to
// permit persons to whom the Software is furnished to do so, subject to
// the following conditions:
//
// The above copyright notice and this permission notice shall be
// included in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,
// EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
// IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
// CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
// TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
// SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
//

/**
 * Basicgen common utilities used by any document type related to Microsoft Office.
 */

var baseobj = require("./basicgen.js");

if ( !String.prototype.encodeHTML ) {
	String.prototype.encodeHTML = function () {
		return this.replace(/&amp;/g, '&amp;amp;')
			.replace(/&lt;/g, '&amp;lt;')
			.replace(/>/g, '&amp;gt;')
			.replace(/"/g, '&amp;quot;');
	};
}

/**
 * This method extending the given officegen object with the common code needed by any MS-Office based document. 
 * Use this module for every type of MS-Office document.
 *
 * @example &lt;caption>Using this module for implementing a new MS-Office based document type:&lt;/caption>
 * var baseobj = require ( "officegen" );
 * var msdoc = require ( "./lib/msofficegen.js" );
 *
 * function makeMyDoc ( officegenObj, typeCodeName, options, officegenObjPlugins, typeInfo ) {
 * 	msdoc.makemsdoc ( officegenObj, typeCodeName, options, officegenObjPlugins, typeInfo );
 * 	officegenObjPlugins.plugs.type.msoffice.makeOfficeGenerator ( 'word', 'document', {} );
 *
 * 	officegenObj.on ( 'clearData', function () {
 * 	});
 * }
 * @param {object} genobj The object to extend.
 * @param {object} new_type The type of object to create.
 * @param {object} options The object's options.
 * @param {object} gen_private Access to the internals of this object.
 * @param {object} type_info Additional information about this type.
 * @summary Extend officegen object with MS-Office support.
 * @constructor
 * @name makemsdoc
 */
function makemsdoc ( genobj, new_type, options, gen_private, type_info ) {
	/**
	 * Generate string of the current date and time.
	 *
	 * This method generating a string with the current date and time in Office XML format.
	 *
	 * @return String of the current date and time in Office XML format.
	 */
	function getCurDateTimeForOffice () {
		var date = new Date ();

		var year = date.getFullYear ();
		var month = date.getMonth () + 1;
		var day = date.getDate ();
		var hour = date.getHours ();
		var min = date.getMinutes ();
		var sec = date.getSeconds ();

		month = (month &lt; 10 ? "0" : "") + month;
		day = (day &lt; 10 ? "0" : "") + day;
		hour = (hour &lt; 10 ? "0" : "") + hour;
		min = (min &lt; 10 ? "0" : "") + min;
		sec = (sec &lt; 10 ? "0" : "") + sec;

		return year + "-" + month + "-" + day + "T" + hour + ":" + min + ":" + sec + 'Z';
	}

	/**
	 * Compact the given array.
	 *
	 * This function compacting the given array.
	 *
	 * @param {object} arr The array to compact.
	 */
	function compactArray ( arr ) {
		var len = arr.length, i, outArray;

		for ( i = 0; i &lt; len; i++ ) {
			if ( arr[i] ) {
				arr.push ( arr[i] );
			} // Endif.
		} // End of for loop.

		arr.splice ( 0 , len ); // Cut the array and leave only the non-empty values.
	}

	/**
	 * Create the main files list resource.
	 *
	 * @param {object} data Ignored by this callback function.
	 * @return Text string.
	 */
	function cbMakeMainFilesList ( data ) {
		var outString = gen_private.plugs.type.msoffice.cbMakeMsOfficeBasicXml ( data );
		outString += '&lt;Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types">';

		for ( var i = 0, total_size = gen_private.type.msoffice.files_list.length; i &lt; total_size; i++ ) {
			if ( typeof gen_private.type.msoffice.files_list[i] != 'undefined' ) {
				if ( gen_private.type.msoffice.files_list[i].ext )
				{
					
					// Fixed by @author:vtloc @date:2014Jan09
					// Reason: if we write out duplicate extension, office will raise error
					//
					if( outString.indexOf('&lt;Default Extension="'+gen_private.type.msoffice.files_list[i].ext) == -1 )
					{ // check to make sure we don't write duplicate extension tag
						outString += '&lt;Default Extension="' + gen_private.type.msoffice.files_list[i].ext + '" ContentType="' + gen_private.type.msoffice.files_list[i].type + '"/>';
					}
				} else
				{
					outString += '&lt;Override PartName="' + gen_private.type.msoffice.files_list[i].name + '" ContentType="' + gen_private.type.msoffice.files_list[i].type + '"/>';
				} // Endif.
			} // Endif.
		} // End of for loop.

		outString += '&lt;/Types>\n';
		return outString;
	}

	/**
	 * ???.
	 *
	 * @param {object} data Ignored by this callback function.
	 * @return Text string.
	 */
	function cbMakeTheme ( data ) {
		if ( genobj.theme ) {
			// console.log ( genobj.theme );
			return genobj.theme;
		} // Endif.

		return gen_private.plugs.type.msoffice.cbMakeMsOfficeBasicXml ( data ) + '&lt;a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme">&lt;a:themeElements>&lt;a:clrScheme name="Office">&lt;a:dk1>&lt;a:sysClr val="windowText" lastClr="000000"/>&lt;/a:dk1>&lt;a:lt1>&lt;a:sysClr val="window" lastClr="FFFFFF"/>&lt;/a:lt1>&lt;a:dk2>&lt;a:srgbClr val="1F497D"/>&lt;/a:dk2>&lt;a:lt2>&lt;a:srgbClr val="EEECE1"/>&lt;/a:lt2>&lt;a:accent1>&lt;a:srgbClr val="4F81BD"/>&lt;/a:accent1>&lt;a:accent2>&lt;a:srgbClr val="C0504D"/>&lt;/a:accent2>&lt;a:accent3>&lt;a:srgbClr val="9BBB59"/>&lt;/a:accent3>&lt;a:accent4>&lt;a:srgbClr val="8064A2"/>&lt;/a:accent4>&lt;a:accent5>&lt;a:srgbClr val="4BACC6"/>&lt;/a:accent5>&lt;a:accent6>&lt;a:srgbClr val="F79646"/>&lt;/a:accent6>&lt;a:hlink>&lt;a:srgbClr val="0000FF"/>&lt;/a:hlink>&lt;a:folHlink>&lt;a:srgbClr val="800080"/>&lt;/a:folHlink>&lt;/a:clrScheme>&lt;a:fontScheme name="Office">&lt;a:majorFont>&lt;a:latin typeface="Calibri"/>&lt;a:ea typeface=""/>&lt;a:cs typeface=""/>&lt;a:font script="Jpan" typeface="MS P????"/>&lt;a:font script="Hang" typeface="?? ??"/>&lt;a:font script="Hans" typeface="??"/>&lt;a:font script="Hant" typeface="????"/>&lt;a:font script="Arab" typeface="Times New Roman"/>&lt;a:font script="Hebr" typeface="Times New Roman"/>&lt;a:font script="Thai" typeface="Angsana New"/>&lt;a:font script="Ethi" typeface="Nyala"/>&lt;a:font script="Beng" typeface="Vrinda"/>&lt;a:font script="Gujr" typeface="Shruti"/>&lt;a:font script="Khmr" typeface="MoolBoran"/>&lt;a:font script="Knda" typeface="Tunga"/>&lt;a:font script="Guru" typeface="Raavi"/>&lt;a:font script="Cans" typeface="Euphemia"/>&lt;a:font script="Cher" typeface="Plantagenet Cherokee"/>&lt;a:font script="Yiii" typeface="Microsoft Yi Baiti"/>&lt;a:font script="Tibt" typeface="Microsoft Himalaya"/>&lt;a:font script="Thaa" typeface="MV Boli"/>&lt;a:font script="Deva" typeface="Mangal"/>&lt;a:font script="Telu" typeface="Gautami"/>&lt;a:font script="Taml" typeface="Latha"/>&lt;a:font script="Syrc" typeface="Estrangelo Edessa"/>&lt;a:font script="Orya" typeface="Kalinga"/>&lt;a:font script="Mlym" typeface="Kartika"/>&lt;a:font script="Laoo" typeface="DokChampa"/>&lt;a:font script="Sinh" typeface="Iskoola Pota"/>&lt;a:font script="Mong" typeface="Mongolian Baiti"/>&lt;a:font script="Viet" typeface="Times New Roman"/>&lt;a:font script="Uigh" typeface="Microsoft Uighur"/>&lt;/a:majorFont>&lt;a:minorFont>&lt;a:latin typeface="Calibri"/>&lt;a:ea typeface=""/>&lt;a:cs typeface=""/>&lt;a:font script="Jpan" typeface="MS P????"/>&lt;a:font script="Hang" typeface="?? ??"/>&lt;a:font script="Hans" typeface="??"/>&lt;a:font script="Hant" typeface="????"/>&lt;a:font script="Arab" typeface="Arial"/>&lt;a:font script="Hebr" typeface="Arial"/>&lt;a:font script="Thai" typeface="Cordia New"/>&lt;a:font script="Ethi" typeface="Nyala"/>&lt;a:font script="Beng" typeface="Vrinda"/>&lt;a:font script="Gujr" typeface="Shruti"/>&lt;a:font script="Khmr" typeface="DaunPenh"/>&lt;a:font script="Knda" typeface="Tunga"/>&lt;a:font script="Guru" typeface="Raavi"/>&lt;a:font script="Cans" typeface="Euphemia"/>&lt;a:font script="Cher" typeface="Plantagenet Cherokee"/>&lt;a:font script="Yiii" typeface="Microsoft Yi Baiti"/>&lt;a:font script="Tibt" typeface="Microsoft Himalaya"/>&lt;a:font script="Thaa" typeface="MV Boli"/>&lt;a:font script="Deva" typeface="Mangal"/>&lt;a:font script="Telu" typeface="Gautami"/>&lt;a:font script="Taml" typeface="Latha"/>&lt;a:font script="Syrc" typeface="Estrangelo Edessa"/>&lt;a:font script="Orya" typeface="Kalinga"/>&lt;a:font script="Mlym" typeface="Kartika"/>&lt;a:font script="Laoo" typeface="DokChampa"/>&lt;a:font script="Sinh" typeface="Iskoola Pota"/>&lt;a:font script="Mong" typeface="Mongolian Baiti"/>&lt;a:font script="Viet" typeface="Arial"/>&lt;a:font script="Uigh" typeface="Microsoft Uighur"/>&lt;/a:minorFont>&lt;/a:fontScheme>&lt;a:fmtScheme name="Office">&lt;a:fillStyleLst>&lt;a:solidFill>&lt;a:schemeClr val="phClr"/>&lt;/a:solidFill>&lt;a:gradFill rotWithShape="1">&lt;a:gsLst>&lt;a:gs pos="0">&lt;a:schemeClr val="phClr">&lt;a:tint val="50000"/>&lt;a:satMod val="300000"/>&lt;/a:schemeClr>&lt;/a:gs>&lt;a:gs pos="35000">&lt;a:schemeClr val="phClr">&lt;a:tint val="37000"/>&lt;a:satMod val="300000"/>&lt;/a:schemeClr>&lt;/a:gs>&lt;a:gs pos="100000">&lt;a:schemeClr val="phClr">&lt;a:tint val="15000"/>&lt;a:satMod val="350000"/>&lt;/a:schemeClr>&lt;/a:gs>&lt;/a:gsLst>&lt;a:lin ang="16200000" scaled="1"/>&lt;/a:gradFill>&lt;a:gradFill rotWithShape="1">&lt;a:gsLst>&lt;a:gs pos="0">&lt;a:schemeClr val="phClr">&lt;a:shade val="51000"/>&lt;a:satMod val="130000"/>&lt;/a:schemeClr>&lt;/a:gs>&lt;a:gs pos="80000">&lt;a:schemeClr val="phClr">&lt;a:shade val="93000"/>&lt;a:satMod val="130000"/>&lt;/a:schemeClr>&lt;/a:gs>&lt;a:gs pos="100000">&lt;a:schemeClr val="phClr">&lt;a:shade val="94000"/>&lt;a:satMod val="135000"/>&lt;/a:schemeClr>&lt;/a:gs>&lt;/a:gsLst>&lt;a:lin ang="16200000" scaled="0"/>&lt;/a:gradFill>&lt;/a:fillStyleLst>&lt;a:lnStyleLst>&lt;a:ln w="9525" cap="flat" cmpd="sng" algn="ctr">&lt;a:solidFill>&lt;a:schemeClr val="phClr">&lt;a:shade val="95000"/>&lt;a:satMod val="105000"/>&lt;/a:schemeClr>&lt;/a:solidFill>&lt;a:prstDash val="solid"/>&lt;/a:ln>&lt;a:ln w="25400" cap="flat" cmpd="sng" algn="ctr">&lt;a:solidFill>&lt;a:schemeClr val="phClr"/>&lt;/a:solidFill>&lt;a:prstDash val="solid"/>&lt;/a:ln>&lt;a:ln w="38100" cap="flat" cmpd="sng" algn="ctr">&lt;a:solidFill>&lt;a:schemeClr val="phClr"/>&lt;/a:solidFill>&lt;a:prstDash val="solid"/>&lt;/a:ln>&lt;/a:lnStyleLst>&lt;a:effectStyleLst>&lt;a:effectStyle>&lt;a:effectLst>&lt;a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0">&lt;a:srgbClr val="000000">&lt;a:alpha val="38000"/>&lt;/a:srgbClr>&lt;/a:outerShdw>&lt;/a:effectLst>&lt;/a:effectStyle>&lt;a:effectStyle>&lt;a:effectLst>&lt;a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0">&lt;a:srgbClr val="000000">&lt;a:alpha val="35000"/>&lt;/a:srgbClr>&lt;/a:outerShdw>&lt;/a:effectLst>&lt;/a:effectStyle>&lt;a:effectStyle>&lt;a:effectLst>&lt;a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0">&lt;a:srgbClr val="000000">&lt;a:alpha val="35000"/>&lt;/a:srgbClr>&lt;/a:outerShdw>&lt;/a:effectLst>&lt;a:scene3d>&lt;a:camera prst="orthographicFront">&lt;a:rot lat="0" lon="0" rev="0"/>&lt;/a:camera>&lt;a:lightRig rig="threePt" dir="t">&lt;a:rot lat="0" lon="0" rev="1200000"/>&lt;/a:lightRig>&lt;/a:scene3d>&lt;a:sp3d>&lt;a:bevelT w="63500" h="25400"/>&lt;/a:sp3d>&lt;/a:effectStyle>&lt;/a:effectStyleLst>&lt;a:bgFillStyleLst>&lt;a:solidFill>&lt;a:schemeClr val="phClr"/>&lt;/a:solidFill>&lt;a:gradFill rotWithShape="1">&lt;a:gsLst>&lt;a:gs pos="0">&lt;a:schemeClr val="phClr">&lt;a:tint val="40000"/>&lt;a:satMod val="350000"/>&lt;/a:schemeClr>&lt;/a:gs>&lt;a:gs pos="40000">&lt;a:schemeClr val="phClr">&lt;a:tint val="45000"/>&lt;a:shade val="99000"/>&lt;a:satMod val="350000"/>&lt;/a:schemeClr>&lt;/a:gs>&lt;a:gs pos="100000">&lt;a:schemeClr val="phClr">&lt;a:shade val="20000"/>&lt;a:satMod val="255000"/>&lt;/a:schemeClr>&lt;/a:gs>&lt;/a:gsLst>&lt;a:path path="circle">&lt;a:fillToRect l="50000" t="-80000" r="50000" b="180000"/>&lt;/a:path>&lt;/a:gradFill>&lt;a:gradFill rotWithShape="1">&lt;a:gsLst>&lt;a:gs pos="0">&lt;a:schemeClr val="phClr">&lt;a:tint val="80000"/>&lt;a:satMod val="300000"/>&lt;/a:schemeClr>&lt;/a:gs>&lt;a:gs pos="100000">&lt;a:schemeClr val="phClr">&lt;a:shade val="30000"/>&lt;a:satMod val="200000"/>&lt;/a:schemeClr>&lt;/a:gs>&lt;/a:gsLst>&lt;a:path path="circle">&lt;a:fillToRect l="50000" t="50000" r="50000" b="50000"/>&lt;/a:path>&lt;/a:gradFill>&lt;/a:bgFillStyleLst>&lt;/a:fmtScheme>&lt;/a:themeElements>&lt;a:objectDefaults/>&lt;a:extraClrSchemeLst/>&lt;/a:theme>';
	}

	/**
	 * ???.
	 *
	 * @param {object} data Ignored by this callback function.
	 * @return Text string.
	 */
	function cbMakeCore ( data ) {
		var curDateTime = getCurDateTimeForOffice ();
		var userName = genobj.options.author || genobj.options.creator || 'officegen';
		var extraFields = '';

		// Work on all the properties:
		for ( var infoRec in genobj.info ) {
			if ( genobj.info[infoRec] &amp;&amp; genobj.info[infoRec].element &amp;&amp; genobj.info[infoRec].data ) {
				extraFields += '&lt;' + genobj.info[infoRec].element + '>' + genobj.info[infoRec].data.encodeHTML () + '&lt;/' + genobj.info[infoRec].element + '>';
			} // Endif.
		} // End of for loop.

		return gen_private.plugs.type.msoffice.cbMakeMsOfficeBasicXml ( data ) + '&lt;cp:coreProperties xmlns:cp="http://schemas.openxmlformats.org/package/2006/metadata/core-properties" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:dcterms="http://purl.org/dc/terms/" xmlns:dcmitype="http://purl.org/dc/dcmitype/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">' + extraFields + '&lt;dc:creator>' + userName + '&lt;/dc:creator>&lt;cp:lastModifiedBy>' + userName + '&lt;/cp:lastModifiedBy>&lt;cp:revision>1&lt;/cp:revision>&lt;dcterms:created xsi:type="dcterms:W3CDTF">' + curDateTime + '&lt;/dcterms:created>&lt;dcterms:modified xsi:type="dcterms:W3CDTF">' + curDateTime + '&lt;/dcterms:modified>&lt;/cp:coreProperties>';
	}

	/**
	 * Remove selected records from the given array.
	 *
	 * This method destroys records inside the given array of the given type.
	 *
	 * @param {object} arr The array to work on it.
	 * @param {object} type_to_clear The type of records to clear.
	 */
	function clearSmartArrayFromType ( arr, type_to_clear ) {
		var is_need_compact = false;

		for ( var i = 0, total_size = arr.length; i &lt; total_size; i++ ) {
			if ( typeof arr[i] != 'undefined' ) {
				if ( arr[i].clear &amp;&amp; (arr[i].clear == type_to_clear) ) {
					delete arr[i];
					is_need_compact = true;
				} // Endif.
			} // Endif.
		} // End of for loop.

		if ( is_need_compact ) {
			compactArray ( arr );
		} // Endif.
	}

	/**
	 * Clean after finishing to generate the document.
	 *
	 * This method destroying any additional resources added by the 'beforeGen' effect to the generator.
	 *
	 * @param {object} err Generation error message (if there were any).
	 * @param {object} written Number of bytes been created.
	 */
	function cbOfficeClearAfterGenerate ( err, written ) {
		clearSmartArrayFromType ( gen_private.type.msoffice.rels_main, 'generate' );
		clearSmartArrayFromType ( gen_private.type.msoffice.rels_app, 'generate' );
		clearSmartArrayFromType ( gen_private.type.msoffice.files_list, 'generate' );

		if ( genobj.generate_data ) {
			genobj.generate_data = null;
			delete genobj.generate_data;
		} // Endif.
	}

	/**
	 * Clear all the information of the current document.
	 */
	function cbOfficeClearDocData () {
		clearSmartArrayFromType ( gen_private.type.msoffice.rels_main, 'data' );
		clearSmartArrayFromType ( gen_private.type.msoffice.rels_app, 'data' );
		clearSmartArrayFromType ( gen_private.type.msoffice.files_list, 'data' );

		for ( var infoItem in genobj.info ) {
			genobj.info[infoItem].data = genobj.info[infoItem].def_data;
		} // Endif.

		gen_private.type.msoffice.src_files_list = [];

		// Ask the document implementation to clear it's data:
		genobj.emit ( 'clearDocType', privateData );
	}

	// Basic API for plugins:

	gen_private.plugs.type.msoffice = {};

	/**
	 * Configure a new Office property type.
	 *
	 * This method register a new type of property that the user can configure. This property must be 
	 * a valid MS-Office property as you can configure on the "files/properties" menu option on MS-Office.
	 *
	 * @param {object} element_name The name of the XML element of this type.
	 * @param {object} def_data Default value of this type.
	 * @param {object} prop_name The name of the options property to configure this type.
	 * @param {object} user_access_func_name The name of the function to create to configure this type.
	 */
	gen_private.plugs.type.msoffice.addInfoType = function ( element_name, def_data, prop_name, user_access_func_name ) {
		genobj.info[element_name] = {};
		genobj.info[element_name].element = element_name;
		genobj.info[element_name].data = def_data;
		genobj.info[element_name].def_data = def_data;

		// The user of officegen can configure this property using the options object:
		if ( genobj.options[prop_name] )
		{
			genobj.info[element_name].data = genobj.options[prop_name];
		} // Endif.

		genobj[user_access_func_name] = function ( new_data ) {
			genobj.info[element_name].data = new_data;
		};
	};

	/**
	 * Get the string that opening every Office XML type.
	 *
	 * Every Microsoft Office XML resource will have this header at the begining of the file.
	 *
	 * @param {object} data Ignored by this callback function.
	 * @return Text string.
	 */
	gen_private.plugs.type.msoffice.cbMakeMsOfficeBasicXml = function ( data ) {
		return '&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n';
	};

	/**
	 * Generate rel based XML file.
	 *
	 * @param {object} data Array filled with all the rels links.
	 * @return Text string.
	 */
	gen_private.plugs.type.msoffice.cbMakeRels = function ( data ) {
		var outString = gen_private.plugs.type.msoffice.cbMakeMsOfficeBasicXml ( data );
		outString += '&lt;Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">';

		// Add all the rels records inside the data array:
		var realRel = 1;
		for ( var i = 0, total_size = data.length; i &lt; total_size; i++ ) {
			if ( typeof data[i] != 'undefined' ) {
				outString += '&lt;Relationship Id="rId' + realRel + '" Type="' + data[i].type + '" Target="' + data[i].target + '"';

				if ( data[i].targetMode ) {
					outString += ' TargetMode="' + data[i].targetMode + '"';
				} // Endif.

				outString += '/>';
				realRel++;
			} // Endif.
		} // End of for loop.

		outString += '&lt;/Relationships>\n';
		return outString;
	};

	/**
	 * Prepare the officegen object to MS-Office documents.
	 *
	 * Every plugin that implementing gemenrating MS-Office document must call this method to initialize 
	 * the common stuff.
	 *
	 * @param {object} main_path The name of the main folder holding the common resources of this type.
	 * @param {object} main_file The main resource file name of this type.
	 * @param {object} ext_opt Optional settings (unused right now).
	 */
	gen_private.plugs.type.msoffice.makeOfficeGenerator = function ( main_path, main_file, ext_opt ) {
		gen_private.features.type.msoffice = {};
		gen_private.features.type.msoffice.main_path = main_path;
		gen_private.features.type.msoffice.main_path_file = main_file;
		gen_private.type.msoffice = {};
		gen_private.type.msoffice.rels_main = [];
		gen_private.type.msoffice.rels_app = [];
		gen_private.type.msoffice.files_list = [];
		gen_private.type.msoffice.src_files_list = [];

		// Holding all the Office properties:
		genobj.info = {};

		genobj.on ( 'afterGen', cbOfficeClearAfterGenerate );
		genobj.on ( 'clearDoc', cbOfficeClearDocData );

		gen_private.type.msoffice.rels_main.push (
			{
				target: 'docProps/app.xml',
				type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties',
				clear: 'type'
			},
			{
				target: 'docProps/core.xml',
				type: 'http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties',
				clear: 'type'
			},
			{
				target: gen_private.features.type.msoffice.main_path + '/' + gen_private.features.type.msoffice.main_path_file + '.xml',
				type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument',
				clear: 'type'
			}
		);

		gen_private.type.msoffice.files_list.push (
			{
				ext: 'rels',
				type: 'application/vnd.openxmlformats-package.relationships+xml',
				clear: 'type'
			},
			{
				ext: 'xml',
				type: 'application/xml',
				clear: 'type'
			},
			{
				ext: 'jpeg',
				type: 'image/jpeg',
				clear: 'type'
			},
			{
				ext: 'png',
				type: 'image/png',
				clear: 'type'
			},
			{
				ext: 'gif',
				type: 'image/gif',
				clear: 'type'
			},
			{
				name: '/docProps/app.xml',
				type: 'application/vnd.openxmlformats-officedocument.extended-properties+xml',
				clear: 'type'
			},
			{
				name: '/' + gen_private.features.type.msoffice.main_path + '/theme/theme1.xml',
				type: 'application/vnd.openxmlformats-officedocument.theme+xml',
				clear: 'type'
			},
			{
				name: '/docProps/core.xml',
				type: 'application/vnd.openxmlformats-package.core-properties+xml',
				clear: 'type'
			}
		);

		genobj.theme = genobj.options.themeXml || null;

		genobj.setTheme = function ( xmlData ) {
			genobj.theme = xmlData;
			// BMK_TODO: BMK_TODO: In the future I'll add a parser to the .thmx files.
		};

		gen_private.plugs.intAddAnyResourceToParse ( '_rels\\.rels', 'buffer', gen_private.type.msoffice.rels_main, gen_private.plugs.type.msoffice.cbMakeRels, true );
		gen_private.plugs.intAddAnyResourceToParse ( '[Content_Types].xml', 'buffer', null, cbMakeMainFilesList, true );
		gen_private.plugs.intAddAnyResourceToParse ( 'docProps\\core.xml', 'buffer', null, cbMakeCore, true );

		gen_private.plugs.intAddAnyResourceToParse ( gen_private.features.type.msoffice.main_path + '\\theme\\theme1.xml', 'buffer', null, cbMakeTheme, true );
	};

	/**
	 * Generate random unique ID.
	 *
	 * This method generates a random unique ID.
	 *
	 * @param {object} baseGroup Optional first part of the ID.
	 * @return Unique ID string.
	 */
	gen_private.plugs.type.msoffice.makeUniqueID = function ( baseGroup ) {
		var charTable = [ '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z' ];

		function makeRandomChar () {
			return charTable [Math.floor ( Math.random () * charTable.length )];
		}

		var outStr = baseGroup || makeRandomChar () + makeRandomChar () + makeRandomChar () + makeRandomChar () + makeRandomChar () + makeRandomChar () + makeRandomChar () + makeRandomChar ();

		outStr += '-' + makeRandomChar () + makeRandomChar () + makeRandomChar () + makeRandomChar ();
		outStr += '-' + makeRandomChar () + makeRandomChar () + makeRandomChar () + makeRandomChar ();
		outStr += '-' + makeRandomChar () + makeRandomChar () + makeRandomChar () + makeRandomChar ();
		outStr += '-' + makeRandomChar () + makeRandomChar () + makeRandomChar () + makeRandomChar ();
		outStr += makeRandomChar () + makeRandomChar () + makeRandomChar () + makeRandomChar ();
		outStr += makeRandomChar () + makeRandomChar () + makeRandomChar () + makeRandomChar ();
		return outStr;
	};

	return this;
}

baseobj.plugins.registerPrototype ( 'msoffice', makemsdoc, 'Microsoft Office Document Prototype' );

exports.makemsdoc = makemsdoc;

</code></pre>
        </article>
    </section>






        

        <footer>
            Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.1</a> on Sun Feb 05 2017 05:03:38 GMT+0100 (W. Europe Standard Time)
        </footer>
    </div>
</div>
<script>prettyPrint();</script>
<script src="scripts/jaguar.js"></script>
</body>
</html>
